<!-- <!DOCTYPE html> -->
<link rel="stylesheet" type ="text/css"  href="board.css">
<div class = "container"></div>
<div class = "winner">
    <head>

    </head>
</div>
<!-- <div class = "blackAIButton"> -->
    <button onclick="blackAI()" class = blackAIButton>Move Black With AI</button>
    <!-- <button onclick="testingBoardAs2DArray()" class = testingBoardAs2DArray>test</button>
    <button onclick="testGlobalNessOfSquareMatrix()" class = testingGlobal>test global</button> -->
    <!-- <button class="button">Button</button> -->
<!-- </div> -->
<button onclick="firstFunction()" class = firstFunction>first function</button>
<div class="currentPlayer"> 
    <span class = "player"></span>
<div class="board"></div>
<div class="restart">
    <button class="playAgain">play again</button>
</div>


<!-- <div class = "moveBlackWithAI">
    <button class = "blackAIButton">Move Black</button>
</div> -->



<!-- <div class = "pieces">
    <div class = "white-pawn"></div>
    <div class = "white-bishop"></div>
    <div class = "white-rook"></div>
    <div class = "white-knight"></div>
    <div class = "white-queen"></div>
    <div class = "white-king"></div>
    <div class = "black-pawn"></div>
    <div class = "black-bishop"></div>
    <div class = "black-rook"></div>
    <div class = "black-knight"></div>
    <div class = "black-queen"></div>
    <div class = "black-king"></div>
</div> -->

<h6 class = "h6"  id = "h6">
    Check out the code for this project on <a href="https://github.com/AnderSwartz/chessAI" target = "_blank">my Github</a>
</h6>
</div>



<script>

    async function firstFunction(){
        console.log("starting firstFunction")
        await secondFunction()
        console.log("ending firstFunction")
    }

    function secondFunction(){
        return new Promise((resolve,reject)=>{
        //here our function should be implemented 
        setTimeout(()=>{
            console.log("Hello from inside the testAsync function");
            resolve();
        ;} ,
        );
    });
    }
    
    var squaresMatrix = new Array
    var previouslyClickedSquare
    whiteWon = false
    blackWon = false
    let board=document.querySelector(".board") 
    let player=document.querySelector(".player") 
    let playAgain=document.querySelector(".playAgain") 
    let restart=document.querySelector(".restart") 
    let moveBlackWithAI = document.querySelector("moveBlackWithAI")
    let blackAIButton = document.querySelector("blackAIButton")
    console.log(moveBlackWithAI)
    let box=0
    let currentPlayer="White's turn"
    var blackLastSelectedPiece = ""
    var blackLastSelectedLocation = ""
    var whiteLastSelectedPiece = ""
    var whiteLastSelectedLocation = ""
    var blackKingOrRookMoved = false
    var whiteKingOrRookMoved = false
    var squares
    var x
    var y
    var blackPieces = ["black-pawn","black-bishop","black-knight","black-rook","black-queen","black-king"]
    var whitePieces = ["white-pawn","white-bishop","white-knight","white-rook","white-queen","white-king"]
    var allPieces = ["black-pawn","black-bishop","black-knight","black-rook","black-queen","black-king",
    "white-pawn","white-bishop","white-knight","white-rook","white-queen","white-king"]
    document.addEventListener("DOMContentLoaded",loadDom)
    // document.addEventListener("mouseover",highlight)

    
    
    //AI gadgets
    var centerSquare = [27,28,35,36]
    var edges = [0,7,15,23,31,39,47,55,63,0,8,16,24,32,40,48,56,1,2,3,
    4,5,6,56,57,58,59,60,61,62]
    var fianchettoSquares = [9,14,49,54]


    
    function wait(ms){
        var start = new Date().getTime();
        var end = start;
        while(end < start + ms) {
            end = new Date().getTime();
        }
    }


    function switchTurn(){
        if(currentPlayer==="White's turn"){
                currentPlayer="Black's turn"
            }
            else{
                currentPlayer="White's turn"
            }
        player.innerHTML=currentPlayer
    }

    function loadDom(){
        console.log("calling loadDom")
        createBoard() 
        player.innerHTML=currentPlayer 
       
        squares=document.querySelectorAll(".board div") 
        Array.from(squares).forEach(square=>{ 
        // square.addEventListener("click",whiteClickBox)
        // square.addEventListener("click",blackClickBox)
        })
        playAgain.addEventListener("click",reset)
    }

    function createBoard(){
        console.log("calling createBoard")
       var black = false;
        for(i=1;i<9;i++){
            black=!black;
            for(j=1;j<9;j++){
                if(!black){
                    let div =document.createElement("div") 
                    div.setAttribute("data-idx",j) 
                    div.setAttribute("data-idy",i) 
                    div.className = "blackSquare" 
                   
                    if(i<3){
                        // div.classList.add("taken")  
                     }
                    else if(i>6){
                        // div.classList.add("taken") 
                    }
                    board.appendChild(div)
                    ////console.log(div)
                    
                }
                else{
                    let div =document.createElement("div") 
                    div.setAttribute("data-idx",j) 
                    div.setAttribute("data-idy",i) 
                    div.className = "whiteSquare" 
                    board.appendChild(div)
                    ////console.log(div)
                    if(i<3){
                        // div.classList.add("taken") 
                     }
                     else if(i>6){
                        // div.classList.add("taken") 
                    }
                }
                
                black=!black;
            }
        }
        fillSquareMatrix()
        createPieces()
        setUpWhitePieceListeners()
        
        
    }

    

    function createPieces(){
        // console.log("calling createPieces")
        // squares =document.querySelectorAll('.board div')
        // let square = squaresMatrix[0][0]
        squaresMatrix[0][0].classList.add("black-rook")
        squaresMatrix[0][1].classList.add("black-knight")
        squaresMatrix[0][2].classList.add("black-bishop")
        squaresMatrix[0][3].classList.add("black-queen")
        squaresMatrix[0][4].classList.add("black-king")
        squaresMatrix[0][5].classList.add("black-bishop")
        squaresMatrix[0][6].classList.add("black-knight")
        squaresMatrix[0][7].classList.add("black-rook")
        
        for(i = 8;i<16;i++){
            squares[i].classList.add("black-pawn")
            // squares[i].classList.add("hasnt-moved")
        }
        squaresMatrix[7][0].classList.add("white-rook")
        squaresMatrix[7][1].classList.add("white-knight")
        squaresMatrix[7][2].classList.add("white-bishop")
        squaresMatrix[7][3].classList.add("white-queen")
        squaresMatrix[7][4].classList.add("white-king")
        squaresMatrix[7][5].classList.add("white-bishop")
        squaresMatrix[7][6].classList.add("white-knight")
        squaresMatrix[7][7].classList.add("white-rook")
        for(i = 48;i<56;i++){
            squares[i].classList.add("white-pawn")
            //squares[i].classList.add("hasnt-moved")
        }
        
    }

    function fillSquareMatrix(){
        console.log("setting up squareMatrix")
        squares =document.querySelectorAll('.board div')
            for(i =0;i<8;i++){
                rowToAdd = new Array 
                for(j =0;j<8;j++){
                    rowToAdd.push(squares[i*8+j])
                }
                squaresMatrix.push(rowToAdd)
            }
      
        
    }

    
    function setUpWhitePieceListeners(){
        squares.forEach(square =>{
        // console.log(square)
        if(square.classList.contains("white-pawn")){
            // console.log("adding whitePawn to",square)
            square.addEventListener("click",whitePawn)
        }
        else if(square.classList.contains("white-bishop")){
            square.addEventListener("click",whiteBishop)
        }
        else if(square.classList.contains("white-rook")){
            square.addEventListener("click",whiteRook)
        }
        else if(square.classList.contains("white-queen")){
            square.addEventListener("click",whiteQueen)
        }
        else if(square.classList.contains("white-king")){
            square.addEventListener("click",whiteKing)
        }
        else if(square.classList.contains("white-knight")){
            square.addEventListener("click",whiteKnight)
        }
    })
    }


    function whiteHighlight(){
        console.log("calling whiteHighlight")
        // //console.log("calling highlight")
        let square = squares[8*(parseInt(this.dataset.idy)-1)+parseInt(this.dataset.idx)-1]
        // if(square.classList.contains("open-square")){
            if(square.classList[0]==="blackSquare"){
            square.classList.add("highlight-dark")
             }
             else{
                 square.classList.add("highlight-light")
            }
        // }
    }

    function whiteUnhighlight(){
        console.log("calling whiteUnhighlight")
        let square = squares[8*(parseInt(this.dataset.idy)-1)+parseInt(this.dataset.idx)-1]
        if(square.classList[0]==="blackSquare"){
            square.classList.remove("highlight-dark")
        }
        else{
            square.classList.remove("highlight-light")
        }
    }

   

    async function whitePawnPromotion(squareIndex){
        
        console.log(squares[squareIndex])
        console.log("calling squareIndex")
        // document.addEventListener("mouseover",whitePawnPromotion)
        // squares.forEach(square =>{
        //     square.removeEventListener("click",whiteClickBox)
        // })
        square = squares[arguments[0]]
            square.classList.remove("white-pawn")
            // square.classList.add("white-queen")
            square.classList.add("prom-white-queen")
            //console.log(square.classList)
            squares[arguments[0]+8].classList.add("prom-white-knight")
            //console.log(squares[arguments[0]+8].classList)
            squares[arguments[0]+16].classList.add("prom-white-rook")
            squares[arguments[0]+24].classList.add("prom-white-bishop")
            // squares[arguments[0]+8].addEventListener(pawnHighlight)
            square.classList.add("pawn-promotion")
            square.addEventListener("mouseover",whitePawnHighlight)
            squares[arguments[0]+8].addEventListener("mouseover",whitePawnHighlight)
            squares[arguments[0]+16].addEventListener("mouseover",whitePawnHighlight)
            squares[arguments[0]+24].addEventListener("mouseover",whitePawnHighlight)
            square.addEventListener("mouseout",whitePawnUnhighlight)
            squares[arguments[0]+8].addEventListener("mouseout",whitePawnUnhighlight)
            squares[arguments[0]+16].addEventListener("mouseout",whitePawnUnhighlight)
            squares[arguments[0]+24].addEventListener("mouseout",whitePawnUnhighlight)
            square.addEventListener("click",whitePromotionChooser)
            squares[arguments[0]+8].addEventListener("click",whitePromotionChooser)
            squares[arguments[0]+16].addEventListener("click",whitePromotionChooser)
            squares[arguments[0]+24].addEventListener("click",whitePromotionChooser)
            //console.log(square.classList)
        
        

        // if(MouseEvent===onclick){
        //     square.classList.remove("pawn-promotion")
        //     squares[arguments[0]+8].classList.remove("pawn-promotion")
        //     squares[arguments[0]+16].classList.remove("pawn-promotion")
        //     squares[arguments[0]+24].classList.remove("pawn-promotion")
        // }
    }

    
       
        
    

    async function whitePromotionChooser(){
        // return new Promise((resolve,reject)=>{
        //here our function should be implemented 
            // setTimeout(()=>{
                // console.log(square)
                console.log("calling whitePromotionChooser")
                let square = squares[8*(parseInt(this.dataset.idy)-1)+parseInt(this.dataset.idx)-1]
            //console.log(square.classList)
                //console.log(parseInt(this.dataset.idy))
                square.classList.remove("pawn-promotion")
                if(parseInt(this.dataset.idy)-1==0){
                    square = squares[8*(parseInt(this.dataset.idy)-1)+parseInt(this.dataset.idx)-1]
                    square.classList.add("white-queen")
                    square.classList.remove("prom-white-queen")
                    
                    //console.log("you chose queen")
                    squares[8*(parseInt(this.dataset.idy)-1+1)+parseInt(this.dataset.idx)-1].classList.remove("prom-white-knight")
                    squares[8*(parseInt(this.dataset.idy)-1+2)+parseInt(this.dataset.idx)-1].classList.remove("prom-white-rook")
                    squares[8*(parseInt(this.dataset.idy)-1+3)+parseInt(this.dataset.idx)-1].classList.remove("prom-white-bishop")
                    // square.classList.remove("pawn-promotion")
                }
                else if(parseInt(this.dataset.idy)-1==1){
                    square = squares[8*(parseInt(this.dataset.idy)-1-1)+parseInt(this.dataset.idx)-1]
                    square.classList.remove("prom-white-queen")
                    square.classList.add("white-knight")
                    //console.log(square.classList)
                    //console.log("you chose knight")
                    squares[8*(parseInt(this.dataset.idy)-1+0)+parseInt(this.dataset.idx)-1].classList.remove("prom-white-knight")
                    squares[8*(parseInt(this.dataset.idy)-1+1)+parseInt(this.dataset.idx)-1].classList.remove("prom-white-rook")
                    squares[8*(parseInt(this.dataset.idy)-1+2)+parseInt(this.dataset.idx)-1].classList.remove("prom-white-bishop")
                }
                else if(parseInt(this.dataset.idy)-1==2){
                    square = squares[8*(parseInt(this.dataset.idy)-1-2)+parseInt(this.dataset.idx)-1]
                    square.classList.remove("prom-white-queen")
                    square.classList.add("white-rook")
                    //console.log(square.classList)
                    squares[8*(parseInt(this.dataset.idy)-1-1)+parseInt(this.dataset.idx)-1].classList.remove("prom-white-knight")
                    squares[8*(parseInt(this.dataset.idy)-1)+parseInt(this.dataset.idx)-1].classList.remove("prom-white-rook")
                    squares[8*(parseInt(this.dataset.idy)-1+1)+parseInt(this.dataset.idx)-1].classList.remove("prom-white-bishop")
                    //console.log("you chose rook")
                }
                else if(parseInt(this.dataset.idy)-1==3){
                    square = squares[8*(parseInt(this.dataset.idy)-1-3)+parseInt(this.dataset.idx)-1]
                    square.classList.remove("prom-white-queen")
                    square.classList.add("white-bishop")
                    square.classList.remove("pawn-promotion")
                    squares[8*(parseInt(this.dataset.idy)-1-2)+parseInt(this.dataset.idx)-1].classList.remove("prom-white-knight")
                    squares[8*(parseInt(this.dataset.idy)-1-1)+parseInt(this.dataset.idx)-1].classList.remove("prom-white-rook")
                    squares[8*(parseInt(this.dataset.idy)-1)+parseInt(this.dataset.idx)-1].classList.remove("prom-white-bishop")
                    //console.log("you chose bishop")
                }
                // square.classList.remove("pawn-promotion")
                switchTurn()
                squares.forEach(square =>{
                    square.addEventListener("click",blackClickBox)
                    square.removeEventListener("click",whitePromotionChooser)
                    square.removeEventListener("mouseover",whitePawnHighlight)
                    square.removeEventListener("mouseout",whitePawnUnhighlight)

                })
                
                isBlackKinginCheck(document.getElementsByClassName("black-king")[0])
                if(document.getElementsByClassName("black-king")[0].classList.contains("check")){
                    didBlackGetMated()
                }
                if(whiteWon){
                    whiteWins()
                }
                console.log("ending white promotion chooser")
                
    }

    function whitePawnHighlight(){
        console.log("calling whitePawnHighlight")
        let square = squares[8*(parseInt(this.dataset.idy)-1)+parseInt(this.dataset.idx)-1]
        square.classList.add("pawn-promotion")
    // //console.log(square.classList)

    }

    function whitePawnUnhighlight(){
        console.log("calling whitePawnUnhighlight")
        let square = squares[8*(parseInt(this.dataset.idy)-1)+parseInt(this.dataset.idx)-1]
        square.classList.remove("pawn-promotion")
        // //console.log(square.classList)
    }

    function blackHighlight(){
        // //console.log("calling highlight")
        console.log("calling blackHighlight")
        let square = squares[8*(parseInt(this.dataset.idy)-1)+parseInt(this.dataset.idx)-1]
        // if(square.classList.contains("open-square")){
            if(square.classList[0]==="blackSquare"){
            square.classList.add("highlight-dark")
             }
             else{
                 square.classList.add("highlight-light")
            }
        // }
    }

    function blackUnhighlight(){
        console.log("calling blackUnhighlight")
        let square = squares[8*(parseInt(this.dataset.idy)-1)+parseInt(this.dataset.idx)-1]
        if(square.classList[0]==="blackSquare"){
            square.classList.remove("highlight-dark")
             }
             else{
                 square.classList.remove("highlight-light")
            }
    }



    function blackPawnPromotion(squareIndex){
        console.log("calling blackPawnPromotion")
        // document.addEventListener("mouseover",whitePawnPromotion)

        squares.forEach(square =>{
            square.removeEventListener("click",blackClickBox)
        })
        square = squares[arguments[0]]
        
     
            square.classList.remove("black-pawn")
            square.classList.add("prom-black-queen")
            //console.log(square.classList)
            squares[arguments[0]-8].classList.add("prom-black-knight")
            //console.log(squares[arguments[0]-8].classList)
            squares[arguments[0]-16].classList.add("prom-black-rook")
            squares[arguments[0]-24].classList.add("prom-black-bishop")
            // squares[arguments[0]+8].addEventListener(pawnHighlight)
            square.classList.add("pawn-promotion")
            square.addEventListener("mouseover",blackPawnHighlight)
            squares[arguments[0]-8].addEventListener("mouseover",blackPawnHighlight)
            squares[arguments[0]-16].addEventListener("mouseover",blackPawnHighlight)
            squares[arguments[0]-24].addEventListener("mouseover",blackPawnHighlight)
            square.addEventListener("mouseout",blackPawnUnhighlight)
            squares[arguments[0]-8].addEventListener("mouseout",blackPawnUnhighlight)
            squares[arguments[0]-16].addEventListener("mouseout",blackPawnUnhighlight)
            squares[arguments[0]-24].addEventListener("mouseout",blackPawnUnhighlight)
            square.addEventListener("click",blackPromotionChooser)
            squares[arguments[0]-8].addEventListener("click",blackPromotionChooser)
            squares[arguments[0]-16].addEventListener("click",blackPromotionChooser)
            squares[arguments[0]-24].addEventListener("click",blackPromotionChooser)
            //console.log(square.classList)
        
        

        // if(MouseEvent===onclick){
        //     square.classList.remove("pawn-promotion")
        //     squares[arguments[0]+8].classList.remove("pawn-promotion")
        //     squares[arguments[0]+16].classList.remove("pawn-promotion")
        //     squares[arguments[0]+24].classList.remove("pawn-promotion")
        // }
    }

    async function blackPromotionChooser(){
        console.log("calling blackPromotionChooser")
        
        //console.log("blackPromotionChooser")

        let square = squares[8*(parseInt(this.dataset.idy)-1)+parseInt(this.dataset.idx)-1]
        //console.log(square.classList)
        //console.log(parseInt(this.dataset.idy))
        square.classList.remove("pawn-promotion")
        if(parseInt(this.dataset.idy)-1==7){
            square = squares[8*(parseInt(this.dataset.idy)-1)+parseInt(this.dataset.idx)-1]
            square.classList.remove("prom-black-queen")
            square.classList.add("black-queen")
            //console.log("you chose queen")
             squares[8*(parseInt(this.dataset.idy)-1-1)+parseInt(this.dataset.idx)-1].classList.remove("prom-black-knight")
             squares[8*(parseInt(this.dataset.idy)-1-2)+parseInt(this.dataset.idx)-1].classList.remove("prom-black-rook")
             squares[8*(parseInt(this.dataset.idy)-1-3)+parseInt(this.dataset.idx)-1].classList.remove("prom-black-bishop")
            // square.classList.remove("pawn-promotion")
        }
        else if(parseInt(this.dataset.idy)-1==6){
            square = squares[8*(parseInt(this.dataset.idy)-1+1)+parseInt(this.dataset.idx)-1]
            square.classList.remove("prom-black-queen")
            square.classList.add("black-knight")
            //console.log(square.classList)
            //console.log("you chose knight")
            squares[8*(parseInt(this.dataset.idy)-1-0)+parseInt(this.dataset.idx)-1].classList.remove("prom-black-knight")
            squares[8*(parseInt(this.dataset.idy)-1-1)+parseInt(this.dataset.idx)-1].classList.remove("prom-black-rook")
            squares[8*(parseInt(this.dataset.idy)-1-2)+parseInt(this.dataset.idx)-1].classList.remove("prom-black-bishop")
        }
        else if(parseInt(this.dataset.idy)-1==5){
            square = squares[8*(parseInt(this.dataset.idy)-1+2)+parseInt(this.dataset.idx)-1]
            square.classList.remove("prom-black-queen")
            square.classList.add("black-rook")
            //console.log(square.classList)
             squares[8*(parseInt(this.dataset.idy)-1+1)+parseInt(this.dataset.idx)-1].classList.remove("prom-black-knight")
               squares[8*(parseInt(this.dataset.idy)-1)+parseInt(this.dataset.idx)-1].classList.remove("prom-black-rook")
             squares[8*(parseInt(this.dataset.idy)-1-1)+parseInt(this.dataset.idx)-1].classList.remove("prom-black-bishop")
            //console.log("you chose rook")
        }
        else if(parseInt(this.dataset.idy)-1==4){
            square = squares[8*(parseInt(this.dataset.idy)-1+3)+parseInt(this.dataset.idx)-1]
            square.classList.remove("prom-black-queen")
            square.classList.add("black-bishop")
            square.classList.remove("pawn-promotion")
             squares[8*(parseInt(this.dataset.idy)-1+2)+parseInt(this.dataset.idx)-1].classList.remove("prom-black-knight")
             squares[8*(parseInt(this.dataset.idy)-1+1)+parseInt(this.dataset.idx)-1].classList.remove("prom-black-rook")
               squares[8*(parseInt(this.dataset.idy)-1)+parseInt(this.dataset.idx)-1].classList.remove("prom-black-bishop")
            //console.log("you chose bishop")
        }
        // square.classList.remove("pawn-promotion")
        
        
        squares.forEach(square =>{
            // square.addEventListener("click",whiteClickBox)
            square.removeEventListener("click",blackPromotionChooser)
            square.removeEventListener("mouseover",blackPawnHighlight)
            square.removeEventListener("mouseout",blackPawnUnhighlight)

        })
        isWhiteKinginCheck(document.getElementsByClassName("white-king")[0])
        if(document.getElementsByClassName("white-king")[0].classList.contains("check")){
                didWhiteGetMated()
        }
        if(blackWon){
            blackWins()
        }
        return
    }

    function blackPawnHighlight(){
        console.log("calling blackPawnHighlight")
        let square = squares[8*(parseInt(this.dataset.idy)-1)+parseInt(this.dataset.idx)-1]
        square.classList.add("pawn-promotion")
    // //console.log(square.classList)

    }

    function blackPawnUnhighlight(){
        console.log("calling blackPawnUnhighlight")
        let square = squares[8*(parseInt(this.dataset.idy)-1)+parseInt(this.dataset.idx)-1]
        square.classList.remove("pawn-promotion")
        // //console.log(square.classList)
    }


    function didBlackGetMated(){
        console.log("calling didBlackGetMated")
        allPossibleMoves = []
        squares.forEach(square=>{
            if(square.classList.contains("black-pawn")){
                // //console.log("found one")
                // //console.log(square)

                blackPawn(square)
                blackLastSelectedPiece = square.classList[1]
                blackLastSelectedLocation = 8*(parseInt(square.dataset.idy)-1)+parseInt(square.dataset.idx)-1
                doesMoveHangBlackKing(true)


                
            }
            else if(square.classList.contains("black-bishop")){
                // //console.log("found one")
                // //console.log(square)

                blackBishop(square)
                blackLastSelectedPiece = square.classList[1]
                blackLastSelectedLocation = 8*(parseInt(square.dataset.idy)-1)+parseInt(square.dataset.idx)-1
                doesMoveHangBlackKing(true)


                
            }
            else if(square.classList.contains("black-rook")){
                // //console.log("found one")
                // //console.log(square)

                blackRook(square)
                blackLastSelectedPiece = square.classList[1]
                blackLastSelectedLocation = 8*(parseInt(square.dataset.idy)-1)+parseInt(square.dataset.idx)-1
                doesMoveHangBlackKing(true)


                
            }
            else if(square.classList.contains("black-knight")){
                // //console.log("found one")
                // //console.log(square)

                blackKnight(square)
                blackLastSelectedPiece = square.classList[1]
                blackLastSelectedLocation = 8*(parseInt(square.dataset.idy)-1)+parseInt(square.dataset.idx)-1
                doesMoveHangBlackKing(true)


                
            }
            else if(square.classList.contains("black-queen")){
                // //console.log("found one")
                // //console.log(square)
                blackQueen(square)
                blackLastSelectedPiece = square.classList[1]
                blackLastSelectedLocation = 8*(parseInt(square.dataset.idy)-1)+parseInt(square.dataset.idx)-1
                doesMoveHangBlackKing(true)

            }
            else if(square.classList.contains("black-king")){
                // //console.log("found one")
                // //console.log(square)
                blackLastSelectedPiece = square.classList[1]
                blackLastSelectedLocation = 8*(parseInt(square.dataset.idy)-1)+parseInt(square.dataset.idx)-1
                blackKing(square)
                doesMoveHangBlackKing(true)

            }
            openSquares = document.getElementsByClassName("open-square")
            for(let square of openSquares){
                allPossibleMoves.push(square)
                square.classList.remove("open-square")
            }
        })
        
        if(allPossibleMoves.length==0){
            whiteWon = true
        }
        
    }

    function didWhiteGetMated(){
        console.log("calling didWhiteGetMated")
        allPossibleMoves = []
        squares.forEach(square=>{
            if(square.classList.contains("white-pawn")){
                // //console.log("found one")
                // //console.log(square)

                whitePawn(square)
                whiteLastSelectedPiece = square.classList[1]
                whiteLastSelectedLocation = 8*(parseInt(square.dataset.idy)-1)+parseInt(square.dataset.idx)-1
                doesMoveHangWhiteKing(true)


                
            }
            else if(square.classList.contains("white-bishop")){
                // //console.log("found one")
                // //console.log(square)

                whiteBishop(square)
                whiteLastSelectedPiece = square.classList[1]
                whiteLastSelectedLocation = 8*(parseInt(square.dataset.idy)-1)+parseInt(square.dataset.idx)-1
                doesMoveHangWhiteKing(true)


                
            }
            else if(square.classList.contains("white-rook")){
                // //console.log("found one")
                // //console.log(square)

                whiteRook(square)
                whiteLastSelectedPiece = square.classList[1]
                whiteLastSelectedLocation = 8*(parseInt(square.dataset.idy)-1)+parseInt(square.dataset.idx)-1
                doesMoveHangWhiteKing(true)


                
            }
            else if(square.classList.contains("white-knight")){
                // //console.log("found one")
                // //console.log(square)

                whiteKnight(square)
                whiteLastSelectedPiece = square.classList[1]
                whiteLastSelectedLocation = 8*(parseInt(square.dataset.idy)-1)+parseInt(square.dataset.idx)-1
                doesMoveHangWhiteKing(true)


                
            }
            else if(square.classList.contains("white-queen")){
                // //console.log("found one")
                // //console.log(square)
                whiteQueen(square)
                whiteLastSelectedPiece = square.classList[1]
                whiteLastSelectedLocation = 8*(parseInt(square.dataset.idy)-1)+parseInt(square.dataset.idx)-1
                doesMoveHangWhiteKing(true)

            }
            else if(square.classList.contains("white-king")){
                // //console.log("found one")
                // //console.log(square)
                whiteLastSelectedPiece = square.classList[1]
                whiteLastSelectedLocation = 8*(parseInt(square.dataset.idy)-1)+parseInt(square.dataset.idx)-1
                whiteKing(square)
                doesMoveHangWhiteKing(true)

            }
            openSquares = document.getElementsByClassName("open-square")
            for(let square of openSquares){
                allPossibleMoves.push(square)
                square.classList.remove("open-square")
                square.classList.remove("selecting-dark")
            }
            
            // square.classList.remove("open-square")
        })
        
        if(allPossibleMoves.length==0){
            blackWon = true
        }
       
    }

    function isBlackKinginCheck(square){
        console.log("calling isBlackKinginCheck")
        squares.forEach(square=>{
            if(square.classList.contains("white-pawn")){
                // //console.log("found one")
                // //console.log(square)

                whitePawn(square)
                
            }
            if(square.classList.contains("white-bishop")){
                // //console.log("found one")
                // //console.log(square)

                whiteBishop(square)
                
            }
            if(square.classList.contains("white-rook")){
                // //console.log("found one")
                // //console.log(square)

                whiteRook(square)
                
            }
            if(square.classList.contains("white-knight")){
                // //console.log("found one")
                // //console.log(square)

                whiteKnight(square)
                
            }
            if(square.classList.contains("white-queen")){
                // //console.log("found one")
                // //console.log(square)
                whiteQueen(square)
            }
            if(square.classList.contains("white-king")){
                // //console.log("found one")
                // //console.log(square)

                whiteKing(square)
                
            }
            // square.classList.remove("open-square")
        })
        // blackPiecesToCapture()
        // if(document.getElementsByClassName("black-king")[0].classList.contains("capturable-light")
        // ||document.getElementsByClassName("black-king")[0].classList.contains("capturable-dark")){
        //     //console.log("black king now in check")
        //     document.getElementsByClassName("black-king")[0].classList.add("check")
        // }
        square.classList.remove("check")
        
        //     square.classList.contains("capturable-light")
        // ||square.classList.contains("capturable-dark"
        if(square.classList.contains("open-square")){
            //console.log("black king now in check")
            square.classList.add("check")
        }

            //comment out to see all potential moves
        squares.forEach(square=>{
            //console.log("removing castleable")

            square.classList.remove("open-square")
            square.classList.remove("selecting-light")
            square.classList.remove("selecting-dark")
            square.classList.remove("capturable-light")
            square.classList.remove("capturable-dark")
            // square.classList.remove("castleable-light")
            // square.classList.remove("castleable-dark")
        })

    }

    function isWhiteKinginCheck(square){
        console.log("calling isWhiteKingInCheck")
        // openSquares = document.getElementsByClassName("open-square")
        // //console.log(openSquares)
        squares.forEach(square=>{
            if(square.classList.contains("black-pawn")){
                // //console.log("found one")
                // //console.log(square)

                blackPawn(square)
                
            }
            if(square.classList.contains("black-bishop")){
                // //console.log("found one")
                // //console.log(square)

                blackBishop(square)
                
            }
            if(square.classList.contains("black-rook")){
                // //console.log("found one")
                // //console.log(square)

                blackRook(square)
                
            }
            if(square.classList.contains("black-knight")){
                // //console.log("found one")
                // //console.log(square)

                blackKnight(square)
                
            }
            if(square.classList.contains("black-queen")){
                // //console.log("found one")
                // //console.log(square)
                blackQueen(square)
            }
            if(square.classList.contains("black-king")){
                // //console.log("found one")
                // //console.log(square)

                blackKing(square)
                
            }
            // square.classList.remove("open-square")
        })
        whitePiecesToCapture()
        // document.getElementsByClassName("white-king")[0].classList.remove("check")
        // if(document.getElementsByClassName("white-king")[0].classList.contains("capturable-light")
        // ||document.getElementsByClassName("white-king")[0].classList.contains("capturable-dark")){
        //     //console.log("white king now in check")
        //     document.getElementsByClassName("white-king")[0].classList.add("check")
        // }
        
        // squares.forEach(square=>{
        //     if(square.classList.contains("capturable-light")
        //     ||square.classList.contains("capturable-dark")){
        //         //console.log(square)
        //     }
        // })


        square.classList.remove("check")
        // if(square.classList.contains("capturable-light")
        // ||square.classList.contains("capturable-dark")
        // ||square.classList.contains("open-square"))
        if(square.classList.contains("open-square")){
            //console.log("white king now in check")
            square.classList.add("check")
        }
     


        // //console.log(openSquares)
        //comment out to see potential moves
        squares.forEach(square=>{

            square.classList.remove("open-square")
            square.classList.remove("selecting-light")
            square.classList.remove("selecting-dark")
            square.classList.remove("capturable-light")
            square.classList.remove("capturable-dark")
            // square.classList.remove("castleable-light")
            // square.classList.remove("castleable-dark")
        })
    }

    async function whiteMoving(){
        // square = squares[whiteLastSelectedLocation]
        // square = squares[8*(parseInt(square.dataset.idy)-1)+parseInt(square.dataset.idx)-1]
        let square = squaresMatrix[parseInt(this.dataset.idy-1)][parseInt(this.dataset.idx-1)]
        console.log(square)
        console.log(whiteLastSelectedPiece)
        whiteIsPromoting = false
        selectingPieceWhite=false
            if(square.classList.contains("black-en-passant-pawn")){
                square.classList.remove("black-pawn")
            }
            if(square.classList.contains("capturable-dark")||square.classList.contains("capturable-light")){
                //console.log("removes piece")
                square.classList.remove(square.classList[1])
            }
            
            // //console.log(whiteLastSelectedPiece)
            // //console.log(whiteLastSelectedLocation)
            // square.classList.add("taken")
            if(whiteLastSelectedPiece==="white-king"&&!whiteKingOrRookMoved&&(square===squaresMatrix[7][6]||square===squaresMatrix[7][7])){
                //console.log("castleing kingside")
                squaresMatrix[7][6].classList.add("white-king")
                squaresMatrix[7][5].classList.add("white-rook")
                squaresMatrix[7][7].classList.remove("white-rook")
                squaresMatrix[7][4].classList.remove("white-king")
            }
            else if(whiteLastSelectedPiece==="white-king"&&!whiteKingOrRookMoved&&(square===squaresMatrix[7][2]||square===squares[56])){
                //console.log("castleing queenside")
                squaresMatrix[7][2].classList.add("white-king")
                squaresMatrix[7][3].classList.add("white-rook")
                squares[56].classList.remove("white-rook")
                squaresMatrix[7][4].classList.remove("white-king")
            }
            else{
                square.classList.add(whiteLastSelectedPiece)
            }
            if(whiteLastSelectedPiece==="white-king"||whiteLastSelectedPiece==="white-rook"){
                whiteKingOrRookMoved = true;
            }
           
            // squares[whiteLastSelectedLocation].classList.remove("taken")
            squares[whiteLastSelectedLocation].classList.remove(whiteLastSelectedPiece)
            // square.classList.remove(check)
            // if( squares[whiteLastSelectedLocation].classList.contains(check)){
                squares[whiteLastSelectedLocation].classList.remove("check")
            // }
            squares.forEach(square =>{
                square.classList.remove("selecting-dark")        
                square.classList.remove("selecting-light")
                square.classList.remove("black-en-passant-pawn")
                if(square.classList.contains("open-square")){
                    square.classList.remove("open-square")
                    square.classList.remove("capturable-dark")
                    square.classList.remove("capturable-light")
                    //console.log(square.classList)
                    // if(square.classList[1]=="black-pawn"){
                    //     square.classList.remove(square.classList[1])
                    // }
                    square.classList.remove("black-en-passant-pawn")
                    square.classList.remove("selecting-dark")        
                    square.classList.remove("castleable-dark")
                    square.classList.remove("castleable-light")
                }
            });
            //en passant candidates
            if(whiteLastSelectedPiece==="white-pawn"&&whiteLastSelectedLocation-16===(8*(parseInt(square.dataset.idy)-1)+parseInt(square.dataset.idx)-1)){
                square.classList.add("white-en-passant-pawn")
            }
             //capturing en passant
             if(square.classList.contains("white-en-passant-square")){
                squares[8*(parseInt(square.dataset.idy)-1+1)+parseInt(square.dataset.idx)-1].classList.remove("black-pawn")
                squares[8*(parseInt(square.dataset.idy)-1+1)+parseInt(square.dataset.idx)-1].classList.remove("black-en-passant-pawn")
                // squares[8*(parseInt(square.dataset.idy)-1+1)+parseInt(square.dataset.idx)-1].classList.remove("capturable-light")
                // squares[8*(parseInt(square.dataset.idy)-1+1)+parseInt(square.dataset.idx)-1].classList.remove("capturable-dark")
                square.classList.remove("white-en-passant-square")
            }
            


            //pawn promotion
            if(whiteLastSelectedPiece==="white-pawn"&&parseInt(square.dataset.idy)===1){
                //console.log("promoting on square "+(8*(parseInt(square.dataset.idy)-1)+parseInt(square.dataset.idx)-1))
                // square.classList.add("white-queen")
                // squares[8*(parseInt(square.dataset.idy)-1)+parseInt(square.dataset.idx)-1+8].classList.add("white-knight")
                // squares[8*(parseInt(square.dataset.idy)-1)+parseInt(square.dataset.idx)-1+16].classList.add("white-rook")
                // squares[8*(parseInt(square.dataset.idy)-1)+parseInt(square.dataset.idx)-1+24].classList.add("white-bishop")
                // squares[arguments[0]+8].addEventListener(pawnHighlight)
                square.classList.remove("white-pawn")
                whitePawnPromotion(8*(parseInt(square.dataset.idy)-1)+parseInt(square.dataset.idx)-1)
                // await whitePromotionChooser()
                whiteIsPromoting = true
                // square.classList.remove("white-queen")
                // squares[8*(parseInt(square.dataset.idy)-1)+parseInt(square.dataset.idx)-1+8].classList.remove("white-knight")
                // squares[8*(parseInt(square.dataset.idy)-1)+parseInt(square.dataset.idx)-1+16].classList.remove("white-rook")
                // squares[8*(parseInt(square.dataset.idy)-1)+parseInt(square.dataset.idx)-1+24].classList.remove("white-bishop")
            }
            if (!whiteIsPromoting){
                switchTurn()
                
                // squares.forEach(square =>{
                //     square.addEventListener("click",blackClickBox)
                //     square.removeEventListener("click",whiteClickBox)
                // })

                
                console.log("checking to see if black king is mated")

                //enemy now in check?
                isBlackKinginCheck(document.getElementsByClassName("black-king")[0])
                if(document.getElementsByClassName("black-king")[0].classList.contains("check")){
                    didBlackGetMated()
                }

                if(whiteLastSelectedPiece=="white-king"){
                    squares[whiteLastSelectedLocation].classList.remove("check")
                }
                else{
                    document.getElementsByClassName("white-king")[0].classList.remove("check")
                }

                square.addEventListener("click",whitePawn)
            }
            whiteIsPromoting = false
            
            
    }

    
   
    

    function whiteSelectingPiece(){
        let square = squaresMatrix[parseInt(this.dataset.idy-1)][parseInt(this.dataset.idx-1)]
        

    }

    // function whiteClickBox(){ 
    //     console.log("calling whiteClickBox")
    //     selectingPieceWhite=true
    //     // //console.log("whiteClickBox called")
    //     // console.log(this.square)
    //     let square = squaresMatrix[parseInt(this.dataset.idy-1)][parseInt(this.dataset.idx-1)]
       
    //     // let square = squares[8*(parseInt(this.dataset.idy)-1)+parseInt(this.dataset.idx)-1]
        
    //     //console.log("just selected: "+ square.classList)
    //     //console.log(squaresMatrix[7][7].value)
    //     square.value = 4; //why?
    //     // //console.log(square.value)
    //     squares.forEach(square =>{
    //         if(square.classList.contains("open-square")){
    //             square.removeEventListener("mouseover",whiteHighlight)
    //             square.removeEventListener("mouseout",whiteUnhighlight)
    //         }
    //         square.classList.remove("highlight-light")
    //         square.classList.remove("highlight-dark")
    //     })
    //     //console.log("whiteLastSelectedPiece "+whiteLastSelectedPiece)
    //     //console.log("whiteLastSelectedLocation "+whiteLastSelectedLocation)
    //     // //console.log(square.classList)
       
    //     // if(selecting){
    //     //     if(square.classList.contains("open-square")){
    //     //         square.classList.remove("open-square")
    //     //         // square.classList.add("")
    //     //     }
    //     // }
        
    //     // if(blackPieces.includes(square.classList[1])){
    //     //     //console.log("yes, black")
    //     // }
    //     if(square.classList.contains("open-square")){
    //         whiteMoving(square) 
    //     }
    //     // else if(square.classList.contains("black,")){
    //     //     //console.log("we did it")
    //     // }
    //     else if(square.classList.contains("white-pawn")){
    //         removeWhiteSelections()
    //         whitePawn(square)
    //     }
    //     else if(square.classList.contains("white-knight")){
    //         removeWhiteSelections()
    //         whiteKnight(square)
    //     }
    //     else if(square.classList.contains("white-bishop")){
    //         removeWhiteSelections()
    //         whiteBishop(square)
    //     }
    //     else if(square.classList.contains("white-rook")){
    //         removeWhiteSelections()
    //         whiteRook(square)

    //     }
    //     else if(square.classList.contains("white-king")){
    //         removeWhiteSelections()
    //         whiteKing(square)

    //     }
    //     else if(square.classList.contains("white-queen")){
    //         removeWhiteSelections()
    //         whiteQueen(square)
    //     }
    //     else{
    //         squares.forEach(square =>{
    //             square.classList.remove("selecting-dark")        
    //             square.classList.remove("selecting-light")
    //             if(square.classList.contains("open-square")){
    //                 square.classList.remove("open-square")
    //                 square.classList.remove("capturable-dark")
    //                 square.classList.remove("capturable-light")
    //             }
    //         });
    //     }
       


    //     // blackPiecesToCapture()

    //     console.log("finished")

    //     whiteLastSelectedPiece = square.classList[1]
    //     whiteLastSelectedLocation = 8*(parseInt(this.dataset.idy)-1)+parseInt(this.dataset.idx)-1
    //     squares.forEach(square =>{
    //         if(square.classList.contains("open-square")){
    //             square.addEventListener("mouseover",whiteHighlight)
    //             square.addEventListener("mouseout",whiteUnhighlight)
    //         }
    //     })  
        
    //     if(selectingPieceWhite){
    //         console.log("YES SELECTING PIECE")
    //         console.log(whiteLastSelectedPiece)
    //         if(document.getElementsByClassName("white-king")[0].classList.contains("check")){
    //             doesMoveHangWhiteKing(true)
    //         }
    //         else{
    //             doesMoveHangWhiteKing(false)
    //         }
    //         blackPiecesToCapture()
    //         if(whiteLastSelectedPiece!="white-king"){
    //             console.log("SHOULD BE REMOVING CASTLEABLE")
    //             //console.log("not selecting white King, so deleting castles")
    //             squaresMatrix[7][7].classList.remove("castleable-dark")
    //             squares[56].classList.remove("castleable-light")
    //         }
    //         if(whitePieces.includes(square.classList[1])){
    //             if(square.classList.contains("blackSquare")){
    //                 square.classList.add("selecting-dark")
    //             }
    //             else{
    //                 square.classList.add("selecting-light")
    //             }
    //         }
    //         squares.forEach(square =>{
    //             square.value = 0
    //         })
    //         openSquareValues = document.getElementsByClassName("open-square")
    //         for(let square of openSquareValues){
    //             countPieceValuesAttackingBlack(square)
    //         }
    //     }


    //     if(!selectingPieceWhite){
    //         //console.log("white just moved, so clearing castles")
    //         squaresMatrix[7][7].classList.remove("castleable-dark")
    //         squares[56].classList.remove("castleable-light")
    //     }
    //     squaresMatrix[0][0].classList.remove("castleable-dark")
    //     squaresMatrix[0][7].classList.remove("castleable-light")
       
    //     // blackPiecesToCapture()
    //     if(whiteWon){
    //             whiteWins()
    //     }
    // }

    function removeWhiteSelections(){
        squares.forEach(square =>{
                square.classList.remove("selecting-dark")        
                square.classList.remove("selecting-light")
                if(square.classList.contains("open-square")){
                    square.classList.remove("open-square")
                    square.classList.remove("capturable-dark")
                    square.classList.remove("capturable-light")

                    square.classList.remove("white-en-passant-square")
                }square.classList.remove("white-en-passant-pawn")
                
        })
    }

    function removeBlackSelections(){
        squares.forEach(square =>{
                square.classList.remove("selecting-dark")        
                square.classList.remove("selecting-light")
                if(square.classList.contains("open-square")){
                    square.classList.remove("open-square")
                    square.classList.remove("capturable-dark")
                    square.classList.remove("capturable-light")

                    square.classList.remove("black-en-passant-square")
                }square.classList.remove("black-en-passant-pawn")
        })
    }


    function doesMoveHangWhiteKing(isKinginCheck){
        console.log("calling doesMoveHangWhiteKing")
        kingInCheck = isKinginCheck
        //console.log("starting code to limit moves")
        var openSquares = document.getElementsByClassName("open-square")
        const movesToCheck = []
        
        

        for(let square of openSquares){
            // //console.log(8*(parseInt(square.dataset.idy)-1)+parseInt(square.dataset.idx)-1)
            movesToCheck.push(squares[8*(parseInt(square.dataset.idy)-1)+parseInt(square.dataset.idx)-1])
        }
        // for(let square of movesToCheck){
        movesToCheck.forEach(square =>{
            tempPieceHolder = false
            movesToCheck.forEach(square =>{
                square.classList.remove("open-square")
            })
            //if the first move evaluated stops check but the next dont, it doesnt work

            //console.log("moving to ",8*(parseInt(square.dataset.idy)-1)+parseInt(square.dataset.idx)-1)
            square.classList.add(whiteLastSelectedPiece)
            squares[whiteLastSelectedLocation].classList.remove(whiteLastSelectedPiece)
            if(blackPieces.includes(square.classList[1])){
                tempPiece = square.classList[1]
                tempPieceHolder = true
                square.classList.remove(square.classList[1])
                // if(square.classList.contains(""))
                // square.classList.add("capturable-light")
            }
            // wait(7000);
            //console.log(square)
            if(whiteLastSelectedPiece=="white-king"){
                isWhiteKinginCheck(square)
                if(!square.classList.contains("check")){
                    square.classList.add("open-square-that-stops-check") 
                    //console.log("would bring king out of check")
                }
                //console.log("dealing with king")
                square.classList.remove("check")
                
            }
            else{
                isWhiteKinginCheck(document.getElementsByClassName("white-king")[0])

                if(!document.getElementsByClassName("white-king")[0].classList.contains("check")){
                    square.classList.add("open-square-that-stops-check")
                // throw new Error("stop!");
                }
            }
            
            if(tempPieceHolder){

                square.classList.add(tempPiece)
                // if(square.classList.contains(""))
                // square.classList.add("capturable-light")
            }
            square.classList.remove(whiteLastSelectedPiece)
            squares[whiteLastSelectedLocation].classList.add(whiteLastSelectedPiece)
            if(isKinginCheck){
                document.getElementsByClassName("white-king")[0].classList.add("check")
            }
            else{
                document.getElementsByClassName("white-king")[0].classList.remove("check")
            }

            // if(whiteLastSelectedPiece=="white-king"){
            //     //console.log("dealing with king")
            //     square.classList.remove("check")
            // }
            // else{
            //     document.getElementsByClassName("white-king")[0].classList.add("check")
            // }
            // //console.log(square)
            
        })
        //console.log("done limiting moves")
        
        for(let square of movesToCheck){
            if(square.classList.contains("open-square-that-stops-check")){
                square.classList.remove("open-square-that-stops-check")
                square.classList.add("open-square")
            }
            else{
                square.removeEventListener("mouseover",whiteHighlight)
                square.removeEventListener("mouseout",whiteUnhighlight)

            }
        }

        if(whiteLastSelectedPiece=="white-king"){
            //console.log(" king")
        }
        else{
        //console.log("not king")
        squaresMatrix[7][7].classList.remove("castleable-dark")
        squares[56].classList.remove("castleable-light")
        }
            
        // }
        // blackPiecesToCapture()
    }

    //can be optimized
    function clearPrevious(){
        squares.forEach(square =>{
            square.classList.remove("open-square")
            square.classList.remove("selecting-dark")        
            square.classList.remove("selecting-light")
            square.removeEventListener("click",whiteMoving)
                if(square.classList.contains("open-square")){
                    square.classList.remove("open-square")
                    square.classList.remove("capturable-dark")
                    square.classList.remove("capturable-light")
                    
                }
        })
    }


////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////        
////////////////////////////////////////////////////////////////////////////////
    

    function addEventListenersToOpenSquares(){
        openSquares =document.querySelectorAll('.open-square')
        // openSquares[0].addEventListener("click",whiteMoving(openSquares[0]))

        openSquares.forEach(square =>{
            square.addEventListener("click",whiteMoving)
        })

    }

    


    //using the argument is only necessary for isblackkingincheck
    function whitePawn(square){
        clearPrevious()
        console.log("calling whitePawn")
        pawns =document.querySelectorAll('.white-pawn')
        if (square.target!=undefined){
            console.log("yes")
            square = squaresMatrix[parseInt(this.dataset.idy-1)][parseInt(this.dataset.idx-1)]
        }
       
        
        
        // square = this
        // let square = squaresMatrix[parseInt(this.dataset.idy-1)][parseInt(this.dataset.idx-1)]
        // let square1 = squaresMatrix[parseInt(this.dataset.idy-1)][parseInt(this.dataset.idx-1)]

        // console.log(square1)
        // console.log(typeof(square))
        // if(typeof square === "undefined"){
        // let square = squaresMatrix[parseInt(this.dataset.idy-1)][parseInt(this.dataset.idx-1)]
        // }
        // let square = squaresMatrix[parseInt(this.dataset.idy-1)][parseInt(this.dataset.idx-1)]

        // console.log(square)
        
        // console.log(square)
        // //console.log("idx = "+idx)
        // //console.log("idy = "+idy)
        // //console.log("new idx= "+square.dataset.idx)
        idx = square.dataset.idx
        idy = square.dataset.idy
        // this.dataset.idx = idx
        // this.dataset.idy = idy

        
        if(square.classList.contains("blackSquare")){
            square.classList.add("selecting-dark")
        }
        else{
            square.classList.add("selecting-light")
        }
        // //console.log("selecting white pawn")

        
        if(!allPieces.includes(squares[(8*(parseInt(idy)-1)+parseInt(idx)-1)-8].classList[1])){
            squares[(8*(parseInt(idy)-1)+parseInt(idx)-1)-8].classList.add("open-square")
            if(parseInt(idy)===7&&!allPieces.includes(squares[(8*(parseInt(idy)-1)+parseInt(idx)-1)-16].classList[1])){
                squares[(8*(parseInt(idy)-1)+parseInt(idx)-1)-16].classList.add("open-square")
            }
        }
 
        // if(document.getElementsByClassName("white-king")[0].classList.contains("check")){
            
        // }

        //up to the right
        if(parseInt(idy)-1-1>-1&&parseInt(idy)-1-1<8
        &&parseInt(idx)-1+1>-1&&parseInt(idx)-1+1<8){
            tempSquare = squares[(8*(parseInt(idy)-1-1)+parseInt(idx)-1+1)]
            if(blackPieces.includes(tempSquare.classList[1])){
                tempSquare.classList.add("open-square")
                

            }
        }
        
        //up to the left
        if(parseInt(idy)-1-1>-1&&parseInt(idy)-1-1<8
        &&parseInt(idx)-1-1>-1&&parseInt(idx)-1-1<8){
            tempSquare = squares[(8*(parseInt(idy)-1-1)+parseInt(idx)-1-1)]
            if(blackPieces.includes(tempSquare.classList[1])){
                tempSquare.classList.add("open-square")
                

            }
        }
            //en passant left
            if(parseInt(idy)-1>-1&&parseInt(idy)-1<8
        &&parseInt(idx)-1-1>-1&&parseInt(idx)-1-1<8){
            tempSquare = squares[(8*(parseInt(idy)-1)+parseInt(idx)-1-1)]
            if(tempSquare.classList.contains("black-en-passant-pawn")){
                squares[(8*(parseInt(idy)-1-1)+parseInt(idx)-1-1)].classList.add("open-square")
                squares[(8*(parseInt(idy)-1-1)+parseInt(idx)-1-1)].classList.add("white-en-passant-square")
                

            }
        }
        //en passant right
        if(parseInt(idy)-1>-1&&parseInt(idy)-1<8
        &&parseInt(idx)-1+1>-1&&parseInt(idx)-1+1<8){
            tempSquare = squares[(8*(parseInt(idy)-1)+parseInt(idx)-1+1)]
            if(tempSquare.classList.contains("black-en-passant-pawn")){
                squares[(8*(parseInt(idy)-1-1)+parseInt(idx)-1+1)].classList.add("open-square")
                squares[(8*(parseInt(idy)-1-1)+parseInt(idx)-1+1)].classList.add("white-en-passant-square")
            }
        }
        openSquares=document.querySelectorAll('open-square')
        whiteLastSelectedPiece =  square.classList[1]
        whiteLastSelectedLocation = 8*(parseInt(square.dataset.idy)-1)+parseInt(square.dataset.idx)-1
        addEventListenersToOpenSquares()
       
    }

    function whiteKnight(square){
        clearPrevious()
        if (square.target!=undefined){
            console.log("yes")
            square = squaresMatrix[parseInt(this.dataset.idy-1)][parseInt(this.dataset.idx-1)]
        }
        

        console.log("calling whiteKnight")
        if(square.classList.contains("blackSquare")){
            square.classList.add("selecting-dark")
        }
        else{
            square.classList.add("selecting-light")
        }
        x=(parseInt(square.dataset.idx)-1+2)
        y=(parseInt(square.dataset.idy)-1-1)
        if(x>-1&&x<8&&y>-1&&y<8&&!whitePieces.includes(squares[(8*(y))+x].classList[1])){
            squares[(8*(y))+x].classList.add("open-square")
        }
        x=(parseInt(square.dataset.idx)-1+2)
        y=(parseInt(square.dataset.idy)-1+1)
        if(x>-1&&x<8&&y>-1&&y<8&&!whitePieces.includes(squares[(8*(y))+x].classList[1])){
            squares[(8*(y))+x].classList.add("open-square")
        }
        x=(parseInt(square.dataset.idx)-1-2)
        y=(parseInt(square.dataset.idy)-1-1)
        if(x>-1&&x<8&&y>-1&&y<8&&!whitePieces.includes(squares[(8*(y))+x].classList[1])){
            squares[(8*(y))+x].classList.add("open-square")
        }
        x=(parseInt(square.dataset.idx)-1-2)
        y=(parseInt(square.dataset.idy)-1+1)
        if(x>-1&&x<8&&y>-1&&y<8&&!whitePieces.includes(squares[(8*(y))+x].classList[1])){
            squares[(8*(y))+x].classList.add("open-square")
        }
        
        x=(parseInt(square.dataset.idx)-1+1)
        y=(parseInt(square.dataset.idy)-1+2)
        if(x>-1&&x<8&&y>-1&&y<8&&!whitePieces.includes(squares[(8*(y))+x].classList[1])){
            squares[(8*(y))+x].classList.add("open-square")
        }
        x=(parseInt(square.dataset.idx)-1+1)
        y=(parseInt(square.dataset.idy)-1-2)
        if(x>-1&&x<8&&y>-1&&y<8&&!whitePieces.includes(squares[(8*(y))+x].classList[1])){
            squares[(8*(y))+x].classList.add("open-square")
        }
        x=(parseInt(square.dataset.idx)-1-1)
        y=(parseInt(square.dataset.idy)-1+2)
        if(x>-1&&x<8&&y>-1&&y<8&&!whitePieces.includes(squares[(8*(y))+x].classList[1])){
            squares[(8*(y))+x].classList.add("open-square")
        }
        x=(parseInt(square.dataset.idx)-1-1)
        y=(parseInt(square.dataset.idy)-1-2)
        if(x>-1&&x<8&&y>-1&&y<8&&!whitePieces.includes(squares[(8*(y))+x].classList[1])){
            squares[(8*(y))+x].classList.add("open-square")
        }
        whiteLastSelectedPiece =  square.classList[1]
        whiteLastSelectedLocation = 8*(parseInt(square.dataset.idy)-1)+parseInt(square.dataset.idx)-1
        addEventListenersToOpenSquares()
    }

    function whiteBishop(square){
        clearPrevious()
        if (square.target!=undefined){
            console.log("yes")
            square = squaresMatrix[parseInt(this.dataset.idy-1)][parseInt(this.dataset.idx-1)]
        }
        console.log("calling whiteBishop")
        if(square.classList.contains("blackSquare")){
            square.classList.add("selecting-dark")
        }
        else{
            square.classList.add("selecting-light")
        }
        var i = 1
        var j = 1
        var flag=true
        while(flag){
            x=(parseInt(square.dataset.idx)-1-i)
            y=(parseInt(square.dataset.idy)-1-j)
            ////console.log(whitePieces.includes(squares[(8*(y))+x]))
            if(x>-1&&x<8&&y>-1&&y<8&&!whitePieces.includes(squares[(8*(y))+x].classList[1])){
                squares[(8*(y))+x].classList.add("open-square")
                if(blackPieces.includes(squares[(8*(y))+x].classList[1])){
                    flag=false
                }
            }
            else{
                flag=false
            }
            i++
            j++
        }
        flag=true
        i=1
        j=1
        while(flag){
            x=(parseInt(square.dataset.idx)-1-i)
            y=(parseInt(square.dataset.idy)-1+j)
            if(x>-1&&x<8&&y>-1&&y<8&&!whitePieces.includes(squares[(8*(y))+x].classList[1])){
                squares[(8*(y))+x].classList.add("open-square")
                if(blackPieces.includes(squares[(8*(y))+x].classList[1])){
                    flag=false
                }
            }
            else{
                flag=false
            }
            i++
            j++
        }
        flag=true
        i=1
        j=1
        while(flag){
            x=(parseInt(square.dataset.idx)-1+i)
            y=(parseInt(square.dataset.idy)-1-j)
            if(x>-1&&x<8&&y>-1&&y<8&&!whitePieces.includes(squares[(8*(y))+x].classList[1])){
                squares[(8*(y))+x].classList.add("open-square")
                if(blackPieces.includes(squares[(8*(y))+x].classList[1])){
                    flag=false
                }
            }
            else{
                flag=false
            }
            i++
            j++
        }
        flag=true
        i=1
        j=1
        while(flag){
            x=(parseInt(square.dataset.idx)-1+i)
            y=(parseInt(square.dataset.idy)-1+j)
            if(x>-1&&x<8&&y>-1&&y<8&&!whitePieces.includes(squares[(8*(y))+x].classList[1])){
                squares[(8*(y))+x].classList.add("open-square")
                if(blackPieces.includes(squares[(8*(y))+x].classList[1])){
                    flag=false
                }
            }
            else{
                flag=false
            }
            i++
            j++
        }
        whiteLastSelectedPiece =  square.classList[1]
        whiteLastSelectedLocation = 8*(parseInt(square.dataset.idy)-1)+parseInt(square.dataset.idx)-1
        addEventListenersToOpenSquares()
    }

    function whiteRook(square){
        clearPrevious()
        if (square.target!=undefined){
            console.log("yes")
            square = squaresMatrix[parseInt(this.dataset.idy-1)][parseInt(this.dataset.idx-1)]
        }
        console.log("calling whiteRook")
        if(square.classList.contains("blackSquare")){
            square.classList.add("selecting-dark")
        }
        else{
            square.classList.add("selecting-light")
        }
        flag=true
        i=1
        while(flag){
            x=(parseInt(square.dataset.idx)-1+i)
            y=(parseInt(square.dataset.idy)-1)
            if(x>-1&&x<8&&y>-1&&y<8&&!whitePieces.includes(squares[(8*(y))+x].classList[1])){
                squares[(8*(y))+x].classList.add("open-square")
                if(blackPieces.includes(squares[(8*(y))+x].classList[1])){
                    flag=false
                }
            }
            else{
                flag=false
            }
            i++
        }
        flag=true
        i=1
        while(flag){
            x=(parseInt(square.dataset.idx)-1-i)
            y=(parseInt(square.dataset.idy)-1)
            if(x>-1&&x<8&&y>-1&&y<8&&!whitePieces.includes(squares[(8*(y))+x].classList[1])){
                squares[(8*(y))+x].classList.add("open-square")
                if(blackPieces.includes(squares[(8*(y))+x].classList[1])){
                    flag=false
                }
            }
            else{
                flag=false
            }
            i++
        }
        flag=true
        i=1
        while(flag){
            x=(parseInt(square.dataset.idx)-1)
            y=(parseInt(square.dataset.idy)-1+i)
            if(x>-1&&x<8&&y>-1&&y<8&&!whitePieces.includes(squares[(8*(y))+x].classList[1])){
                squares[(8*(y))+x].classList.add("open-square")
                if(blackPieces.includes(squares[(8*(y))+x].classList[1])){
                    flag=false
                }
            }
            else{
                flag=false
            }
            i++
        }
        flag=true
        i=1
        while(flag){
            x=(parseInt(square.dataset.idx)-1)
            y=(parseInt(square.dataset.idy)-1-i)
            if(x>-1&&x<8&&y>-1&&y<8&&!whitePieces.includes(squares[(8*(y))+x].classList[1])){
                squares[(8*(y))+x].classList.add("open-square")
                if(blackPieces.includes(squares[(8*(y))+x].classList[1])){
                    flag=false
                }
            }
            else{
                flag=false
            }
            i++
        }
        whiteLastSelectedPiece =  square.classList[1]
        whiteLastSelectedLocation = 8*(parseInt(square.dataset.idy)-1)+parseInt(square.dataset.idx)-1
        addEventListenersToOpenSquares()
    }

    function whiteKing(square){
        clearPrevious()
        if (square.target!=undefined){
            console.log("yes")
            square = squaresMatrix[parseInt(this.dataset.idy-1)][parseInt(this.dataset.idx-1)]
        }
        console.log("calling whiteKing")
        if(square.classList.contains("blackSquare")){
            square.classList.add("selecting-dark")
        }
        else{
            square.classList.add("selecting-light")
        }
        x=(parseInt(square.dataset.idx)-1)
        y=(parseInt(square.dataset.idy)-1+1)
        if(x>-1&&x<8&&y>-1&&y<8&&!whitePieces.includes(squares[(8*(y))+x].classList[1])){
            squares[(8*(y))+x].classList.add("open-square")
        }
        x=(parseInt(square.dataset.idx)-1)
        y=(parseInt(square.dataset.idy)-1-1)
        if(x>-1&&x<8&&y>-1&&y<8&&!whitePieces.includes(squares[(8*(y))+x].classList[1])){
            squares[(8*(y))+x].classList.add("open-square")
        }
        x=(parseInt(square.dataset.idx)-1+1)
        y=(parseInt(square.dataset.idy)-1-1)
        if(x>-1&&x<8&&y>-1&&y<8&&!whitePieces.includes(squares[(8*(y))+x].classList[1])){
            squares[(8*(y))+x].classList.add("open-square")
        }
        x=(parseInt(square.dataset.idx)-1+1)
        y=(parseInt(square.dataset.idy)-1)
        if(x>-1&&x<8&&y>-1&&y<8&&!whitePieces.includes(squares[(8*(y))+x].classList[1])){
            squares[(8*(y))+x].classList.add("open-square")
        }
        x=(parseInt(square.dataset.idx)-1+1)
        y=(parseInt(square.dataset.idy)-1+1)
        if(x>-1&&x<8&&y>-1&&y<8&&!whitePieces.includes(squares[(8*(y))+x].classList[1])){
            squares[(8*(y))+x].classList.add("open-square")
        }
        x=(parseInt(square.dataset.idx)-1-1)
        y=(parseInt(square.dataset.idy)-1-1)
        if(x>-1&&x<8&&y>-1&&y<8&&!whitePieces.includes(squares[(8*(y))+x].classList[1])){
            squares[(8*(y))+x].classList.add("open-square")
        }
        x=(parseInt(square.dataset.idx)-1-1)
        y=(parseInt(square.dataset.idy)-1)
        if(x>-1&&x<8&&y>-1&&y<8&&!whitePieces.includes(squares[(8*(y))+x].classList[1])){
            squares[(8*(y))+x].classList.add("open-square")
        }
        x=(parseInt(square.dataset.idx)-1-1)
        y=(parseInt(square.dataset.idy)-1+1)
        if(x>-1&&x<8&&y>-1&&y<8&&!whitePieces.includes(squares[(8*(y))+x].classList[1])){
            squares[(8*(y))+x].classList.add("open-square")
        }
        if(!whiteKingOrRookMoved&&!allPieces.includes(squaresMatrix[7][5].classList[1])&&!allPieces.includes(squaresMatrix[7][6].classList[1])){
            squaresMatrix[7][6].classList.add("open-square")
            squaresMatrix[7][7].classList.add("open-square")
            squaresMatrix[7][7].classList.add("castleable-dark")
            //console.log("adding castleable")
        }
        if(!whiteKingOrRookMoved&&!allPieces.includes(squaresMatrix[7][3].classList[1])&&!allPieces.includes(squaresMatrix[7][2].classList[1])&&!allPieces.includes(squaresMatrix[7][1].classList[1])){
            squaresMatrix[7][2].classList.add("open-square")
            squares[56].classList.add("open-square")
            squares[56].classList.add("castleable-light")
        }
        whiteLastSelectedPiece =  square.classList[1]
        whiteLastSelectedLocation = 8*(parseInt(square.dataset.idy)-1)+parseInt(square.dataset.idx)-1
        addEventListenersToOpenSquares()
    }

    function whiteQueen(square){
        clearPrevious()
        if (square.target!=undefined){
            console.log("yes")
            square = squaresMatrix[parseInt(this.dataset.idy-1)][parseInt(this.dataset.idx-1)]
        }
        console.log("calling whiteQueen")
        if(square.classList.contains("blackSquare")){
            square.classList.add("selecting-dark")
        }
        else{
            square.classList.add("selecting-light")
        }
    
        var i = 1
        var j = 1
        var flag=true
        while(flag){
            x=(parseInt(square.dataset.idx)-1-i)
            y=(parseInt(square.dataset.idy)-1-j)
            if(x>-1&&x<8&&y>-1&&y<8&&!whitePieces.includes(squares[(8*(y))+x].classList[1])){
                squares[(8*(y))+x].classList.add("open-square")
                if(blackPieces.includes(squares[(8*(y))+x].classList[1])){
                    flag=false
                }
            }
            else{
                flag=false
            }
            i++
            j++
        }
        flag=true
        i=1
        j=1
        while(flag){
            x=(parseInt(square.dataset.idx)-1-i)
            y=(parseInt(square.dataset.idy)-1+j)
            if(x>-1&&x<8&&y>-1&&y<8&&!whitePieces.includes(squares[(8*(y))+x].classList[1])){
                squares[(8*(y))+x].classList.add("open-square")
                if(blackPieces.includes(squares[(8*(y))+x].classList[1])){
                    flag=false
                }
            }
            else{
                flag=false
            }
            i++
            j++
        }
        flag=true
        i=1
        j=1
        while(flag){
            x=(parseInt(square.dataset.idx)-1+i)
            y=(parseInt(square.dataset.idy)-1-j)
            if(x>-1&&x<8&&y>-1&&y<8&&!whitePieces.includes(squares[(8*(y))+x].classList[1])){
                squares[(8*(y))+x].classList.add("open-square")
                if(blackPieces.includes(squares[(8*(y))+x].classList[1])){
                    flag=false
                }
            }
            else{
                flag=false
            }
            i++
            j++
        }
        flag=true
        i=1
        j=1
        while(flag){
            x=(parseInt(square.dataset.idx)-1+i)
            y=(parseInt(square.dataset.idy)-1+j)
            if(x>-1&&x<8&&y>-1&&y<8&&!whitePieces.includes(squares[(8*(y))+x].classList[1])){
                squares[(8*(y))+x].classList.add("open-square")
                if(blackPieces.includes(squares[(8*(y))+x].classList[1])){
                    flag=false
                }
            }
            else{
                flag=false
            }
            i++
            j++
        }
        flag=true
        i=1
        while(flag){
            x=(parseInt(square.dataset.idx)-1+i)
            y=(parseInt(square.dataset.idy)-1)
            if(x>-1&&x<8&&y>-1&&y<8&&!whitePieces.includes(squares[(8*(y))+x].classList[1])){
                squares[(8*(y))+x].classList.add("open-square")
                if(blackPieces.includes(squares[(8*(y))+x].classList[1])){
                    flag=false
                }
            }
            else{
                flag=false
            }
            i++
        }
        flag=true
        i=1
        while(flag){
            x=(parseInt(square.dataset.idx)-1-i)
            y=(parseInt(square.dataset.idy)-1)
            if(x>-1&&x<8&&y>-1&&y<8&&!whitePieces.includes(squares[(8*(y))+x].classList[1])){
                squares[(8*(y))+x].classList.add("open-square")
                if(blackPieces.includes(squares[(8*(y))+x].classList[1])){
                    flag=false
                }
            }
            else{
                flag=false
            }
            i++
        }
        flag=true
        i=1
        while(flag){
            x=(parseInt(square.dataset.idx)-1)
            y=(parseInt(square.dataset.idy)-1+i)
            if(x>-1&&x<8&&y>-1&&y<8&&!whitePieces.includes(squares[(8*(y))+x].classList[1])){
                squares[(8*(y))+x].classList.add("open-square")
                if(blackPieces.includes(squares[(8*(y))+x].classList[1])){
                    flag=false
                }
            }
            else{
                flag=false
            }
            i++
        }
        flag=true
        i=1
        while(flag){
            x=(parseInt(square.dataset.idx)-1)
            y=(parseInt(square.dataset.idy)-1-i)
            if(x>-1&&x<8&&y>-1&&y<8&&!whitePieces.includes(squares[(8*(y))+x].classList[1])){
                squares[(8*(y))+x].classList.add("open-square")
                if(blackPieces.includes(squares[(8*(y))+x].classList[1])){
                    flag=false
                }
            }
            else{
                flag=false
            }
            i++
        }
        whiteLastSelectedPiece =  square.classList[1]
        whiteLastSelectedLocation = 8*(parseInt(square.dataset.idy)-1)+parseInt(square.dataset.idx)-1
        addEventListenersToOpenSquares()
    }

    function blackPiecesToCapture(){
        console.log("calling blackPiecesToCapture")
        squares.forEach(square =>{
            // //console.log(square.classList.contains("open-square"))
            if(square.classList.contains("open-square")&&blackPieces.includes(square.classList[1])||
            square.classList[1]=="black-en-passant-pawn"){
            // ||blackPieces.includes(square.classList[2])){
                if(square.classList[0]=="blackSquare"){
                    // square.classList.remove("open-square")
                    square.classList.add("capturable-dark")
                }
                
                else{
                    // square.classList.remove("open-square")
                    square.classList.add("capturable-light")
                }
            }
        });
    }


    function countPieceValuesAttackingWhite(square){
        console.log("calling countPieceValeusAttackingWhite")
        if(square.classList.contains("white-pawn")||square.classList.contains("black-en-passant-square")){
            square.value += 1
        }
        else if(square.classList.contains("black-pawn-en-passant")){
            square.value += 1
        }
        else if(square.classList.contains("white-knight")){
            square.value += 3
        }
        else if(square.classList.contains("white-bishop")){
            square.value += 3
        }
        else if(square.classList.contains("white-rook")){
            square.value += 5
        }
        else if(square.classList.contains("white-queen")){
            square.value += 9
        }
        else if(square.classList.contains("white-king")){
            square.value += 1000
        }
        
    }

    function countPieceValuesAttackingBlack(square){
        console.log("calling countPieceValuesAttackingBlack")
        if(square.classList.contains("black-pawn")){
            square.value = 1
        }
        else if(square.classList.contains("white-pawn-en-passant")){
            square.value = 1
        }
        else if(square.classList.contains("black-knight")){
            square.value = 3
        }
        else if(square.classList.contains("black-bishop")){
            square.value = 3
        }
        else if(square.classList.contains("black-rook")){
            square.value = 5
        }
        else if(square.classList.contains("black-queen")){
            square.value = 9
        }
        else if(square.classList.contains("black-king")){
            square.value = 1000
        }
    }


    function whitePiecesToCapture(){
        console.log("calling whitePiecesToCapture")
        squares.forEach(square =>{
     
            // //console.log(square.classList.contains("open-square"))
            if(square.classList.contains("open-square")&&(whitePieces.includes(square.classList[1])
            ||square.classList[1]=="white-en-passant-pawn")){
                if(square.classList[0]=="blackSquare"){
                    // square.classList.remove("open-square")
                    square.classList.add("capturable-dark")
                }
                else{
                    // square.classList.remove("open-square")
                    square.classList.add("capturable-light")
                }
            }
        });
    }   
    
    async function blackMoving(square){
        console.log("calling blackMoving")
        selectingPieceBlack=false
            if(square.classList.contains("white-en-passant-pawn")){
                square.classList.remove("white-pawn")
            }
            if(square.classList.contains("capturable-dark")||square.classList.contains("capturable-light")){
                square.classList.remove(square.classList[1])
            }
            
            // //console.log(blackLastSelectedPiece)
            // //console.log(blackLastSelectedLocation)
            // square.classList.add("taken")
            if(blackLastSelectedPiece==="black-king"&&blackLastSelectedLocation===4&&!blackKingOrRookMoved&&(square===squaresMatrix[0][6]||square===squaresMatrix[0][7])){
                //console.log("castleing kingside")
                squaresMatrix[0][6].classList.add("black-king")
                squaresMatrix[0][5].classList.add("black-rook")
                squaresMatrix[0][7].classList.remove("black-rook")
                squaresMatrix[0][4].classList.remove("black-king")
            }
            else if(blackLastSelectedPiece==="black-king"&&blackLastSelectedLocation===4&&!blackKingOrRookMoved&&(square===squaresMatrix[0][2]||square===squaresMatrix[0][0])){
                //console.log("castleing queenside")
                squaresMatrix[0][2].classList.add("black-king")
                squaresMatrix[0][3].classList.add("black-rook")
                squaresMatrix[0][0].classList.remove("black-rook")
                squaresMatrix[0][4].classList.remove("black-king")
            }
            else{
                square.classList.add(blackLastSelectedPiece)
            }
            if(blackLastSelectedPiece==="black-king"||blackLastSelectedPiece==="black-rook"){
                blackKingOrRookMoved = true;
            }
        


            // squares[blackLastSelectedLocation].classList.remove("taken")
            squares[blackLastSelectedLocation].classList.remove(blackLastSelectedPiece)
            squares.forEach(square =>{
                square.classList.remove("selecting-dark")        
                    square.classList.remove("selecting-light")
                    square.classList.remove("white-en-passant-pawn")
                if(square.classList.contains("open-square")){
                    square.classList.remove("open-square")
                    square.classList.remove("capturable-dark")
                    square.classList.remove("capturable-light")
                    // if(square.classList[1]=="white-pawn"){
                    //     square.classList.remove(square.classList[1])
                    // }
                    // square.classList.remove("white-pawn")
                    square.classList.remove("castleable-dark")
                    square.classList.remove("castleable-light")
                    // if(whitePieces.includes(square.classList[1])){
                    //     square.classList.remove(square.classList[1])
                    // }
                }
            });
            //pawn promotion
            if(blackLastSelectedPiece==="black-pawn"&&parseInt(square.dataset.idy)===8){
                //console.log("promoting on square "+(8*(parseInt(square.dataset.idy)-1)+parseInt(square.dataset.idx)-1))
                // square.classList.add("black-queen")
                // squares[8*(parseInt(square.dataset.idy)-1)+parseInt(square.dataset.idx)-1+8].classList.add("black-knight")
                // squares[8*(parseInt(square.dataset.idy)-1)+parseInt(square.dataset.idx)-1+16].classList.add("black-rook")
                // squares[8*(parseInt(square.dataset.idy)-1)+parseInt(square.dataset.idx)-1+24].classList.add("black-bishop")
                // squares[arguments[0]+8].addEventListener(pawnHighlight)
                square.classList.remove("black-pawn")
                blackPawnPromotion(8*(parseInt(square.dataset.idy)-1)+parseInt(square.dataset.idx)-1)
                // await blackPromotionChooser()
                //console.log("done promoting")
                // square.classList.remove("black-queen")
                // squares[8*(parseInt(square.dataset.idy)-1)+parseInt(square.dataset.idx)-1+8].classList.remove("black-knight")
                // squares[8*(parseInt(square.dataset.idy)-1)+parseInt(square.dataset.idx)-1+16].classList.remove("black-rook")
                // squares[8*(parseInt(square.dataset.idy)-1)+parseInt(square.dataset.idx)-1+24].classList.remove("black-bishop")
            }

            //en passant candidates
            if(blackLastSelectedPiece==="black-pawn"&&blackLastSelectedLocation+16===(8*(parseInt(square.dataset.idy)-1)+parseInt(square.dataset.idx)-1)){
                square.classList.add("black-en-passant-pawn")
            }


            //capturing en passant
            if(square.classList.contains("black-en-passant-square")){
                squares[8*(parseInt(square.dataset.idy)-1-1)+parseInt(square.dataset.idx)-1].classList.remove("white-pawn")
                //these 3 lines cause error because of this not being square. dont think they are necessary tho
                // squares[8*(parseInt(this.dataset.idy)-1+1)+parseInt(this.dataset.idx)-1].classList.remove("white-en-passant-pawn")
                // squares[8*(parseInt(this.dataset.idy)-1+1)+parseInt(this.dataset.idx)-1].classList.remove("capturable-light")
                // squares[8*(parseInt(this.dataset.idy)-1+1)+parseInt(this.dataset.idx)-1].classList.remove("capturable-dark")
                square.classList.remove("black-en-passant-square")
            }



            switchTurn()
            

            // squares.forEach(square =>{
            //     square.addEventListener("click",whiteClickBox)
            //     square.removeEventListener("click",blackClickBox)
            // })

            
            //enemy now in check?
            isWhiteKinginCheck(document.getElementsByClassName("white-king")[0])
           

            if(document.getElementsByClassName("white-king")[0].classList.contains("check")){
                didWhiteGetMated()
            }
            if(blackLastSelectedPiece=="black-king"){
                squares[blackLastSelectedLocation].classList.remove("check")
            }
            else{
                document.getElementsByClassName("black-king")[0].classList.remove("check")
            }
    }

    async function blackClickBox(squareGiven){ 
        console.log("calling blackClickBox")
        // var b = squareGiven.contains(MouseEvent)
        console.log(squareGiven.path==null)
        if(squareGiven.path==null){ //we were given square by AI 
            console.log("chosen by AI")         
            square = squareGiven
        }
        else{
            console.log("clicked manually")
            square = squares[8*(parseInt(this.dataset.idy)-1)+parseInt(this.dataset.idx)-1]
        }
        // console.log(squares[8*(parseInt(squareGiven.dataset.idy)-1)+parseInt(squareGiven.dataset.idx)-1])
        selectingPieceBlack=true
        
        //console.log("just selected: "+ square.classList)
        
        squares.forEach(square =>{
            if(square.classList.contains("open-square")){
                square.removeEventListener("mouseover",blackHighlight)
                square.removeEventListener("mouseout",blackUnhighlight)
            }
            square.classList.remove("highlight-light")
            square.classList.remove("highlight-dark")
        })

        //console.log("blackLastSelectedPiece "+blackLastSelectedPiece)
        //console.log("blackLastSelectedLocation "+blackLastSelectedLocation)
        // //console.log(square.classList)
       
        // if(selecting){
        //     if(square.classList.contains("open-square")){
        //         square.classList.remove("open-square")
        //         // square.classList.add("")
        //     }
        // }
        
        // if(blackPieces.includes(square.classList[1])){
        //     //console.log("yes, black")
        // }
        if(square.classList.contains("open-square")){
            blackMoving(square)
            // selectingPieceBlack=false
            // if(square.classList.contains("white-en-passant-pawn")){
            //     square.classList.remove("white-pawn")
            // }
            // if(square.classList.contains("capturable-dark")||square.classList.contains("capturable-light")){
            //     square.classList.remove(square.classList[1])
            // }
            
            // // //console.log(blackLastSelectedPiece)
            // // //console.log(blackLastSelectedLocation)
            // // square.classList.add("taken")
            // if(blackLastSelectedPiece==="black-king"&&blackLastSelectedLocation===4&&!blackKingOrRookMoved&&(square===squaresMatrix[0][6]||square===squaresMatrix[0][7])){
            //     //console.log("castleing kingside")
            //     squaresMatrix[0][6].classList.add("black-king")
            //     squaresMatrix[0][5].classList.add("black-rook")
            //     squaresMatrix[0][7].classList.remove("black-rook")
            //     squaresMatrix[0][4].classList.remove("black-king")
            // }
            // else if(blackLastSelectedPiece==="black-king"&&blackLastSelectedLocation===4&&!blackKingOrRookMoved&&(square===squaresMatrix[0][2]||square===squaresMatrix[0][0])){
            //     //console.log("castleing queenside")
            //     squaresMatrix[0][2].classList.add("black-king")
            //     squaresMatrix[0][3].classList.add("black-rook")
            //     squaresMatrix[0][0].classList.remove("black-rook")
            //     squaresMatrix[0][4].classList.remove("black-king")
            // }
            // else{
            //     square.classList.add(blackLastSelectedPiece)
            // }
            // if(blackLastSelectedPiece==="black-king"||blackLastSelectedPiece==="black-rook"){
            //     blackKingOrRookMoved = true;
            // }
        


            // // squares[blackLastSelectedLocation].classList.remove("taken")
            // squares[blackLastSelectedLocation].classList.remove(blackLastSelectedPiece)
            // squares.forEach(square =>{
            //     square.classList.remove("selecting-dark")        
            //         square.classList.remove("selecting-light")
            //         square.classList.remove("white-en-passant-pawn")
            //     if(square.classList.contains("open-square")){
            //         square.classList.remove("open-square")
            //         square.classList.remove("capturable-dark")
            //         square.classList.remove("capturable-light")
            //         // if(square.classList[1]=="white-pawn"){
            //         //     square.classList.remove(square.classList[1])
            //         // }
            //         // square.classList.remove("white-pawn")
            //         square.classList.remove("castleable-dark")
            //         square.classList.remove("castleable-light")
            //         // if(whitePieces.includes(square.classList[1])){
            //         //     square.classList.remove(square.classList[1])
            //         // }
            //     }
            // });
            // //pawn promotion
            // if(blackLastSelectedPiece==="black-pawn"&&parseInt(square.dataset.idy)===8){
            //     //console.log("promoting on square "+(8*(parseInt(square.dataset.idy)-1)+parseInt(square.dataset.idx)-1))
            //     // square.classList.add("black-queen")
            //     // squares[8*(parseInt(square.dataset.idy)-1)+parseInt(square.dataset.idx)-1+8].classList.add("black-knight")
            //     // squares[8*(parseInt(square.dataset.idy)-1)+parseInt(square.dataset.idx)-1+16].classList.add("black-rook")
            //     // squares[8*(parseInt(square.dataset.idy)-1)+parseInt(square.dataset.idx)-1+24].classList.add("black-bishop")
            //     // squares[arguments[0]+8].addEventListener(pawnHighlight)
            //     square.classList.remove("black-pawn")
            //     blackPawnPromotion(8*(parseInt(square.dataset.idy)-1)+parseInt(square.dataset.idx)-1)
            //     //console.log("done promoting")
            //     // square.classList.remove("black-queen")
            //     // squares[8*(parseInt(square.dataset.idy)-1)+parseInt(square.dataset.idx)-1+8].classList.remove("black-knight")
            //     // squares[8*(parseInt(square.dataset.idy)-1)+parseInt(square.dataset.idx)-1+16].classList.remove("black-rook")
            //     // squares[8*(parseInt(square.dataset.idy)-1)+parseInt(square.dataset.idx)-1+24].classList.remove("black-bishop")
            // }

            // //en passant candidates
            // if(blackLastSelectedPiece==="black-pawn"&&blackLastSelectedLocation+16===(8*(parseInt(square.dataset.idy)-1)+parseInt(square.dataset.idx)-1)){
            //     square.classList.add("black-en-passant-pawn")
            // }


            // //capturing en passant
            // if(square.classList.contains("black-en-passant-square")){
            //     squares[8*(parseInt(square.dataset.idy)-1-1)+parseInt(square.dataset.idx)-1].classList.remove("white-pawn")
            //     squares[8*(parseInt(this.dataset.idy)-1+1)+parseInt(this.dataset.idx)-1].classList.remove("white-en-passant-pawn")
            //     // squares[8*(parseInt(this.dataset.idy)-1+1)+parseInt(this.dataset.idx)-1].classList.remove("capturable-light")
            //     // squares[8*(parseInt(this.dataset.idy)-1+1)+parseInt(this.dataset.idx)-1].classList.remove("capturable-dark")
            //     square.classList.remove("black-en-passant-square")
            // }



            // if(currentPlayer==="White's turn"){
            //     currentPlayer="Black's turn"
            // }
            // else{
            //     currentPlayer="White's turn"
            // }
            // player.innerHTML=currentPlayer
            // squares.forEach(square =>{
            //     square.addEventListener("click",whiteClickBox)
            //     square.removeEventListener("click",blackClickBox)
            // })

            
            // //enemy now in check?
            // isWhiteKinginCheck(document.getElementsByClassName("white-king")[0])
           

            // if(document.getElementsByClassName("white-king")[0].classList.contains("check")){
            //     didWhiteGetMated()
            // }
            // if(blackLastSelectedPiece=="black-king"){
            //     squares[blackLastSelectedLocation].classList.remove("check")
            // }
            // else{
            //     document.getElementsByClassName("black-king")[0].classList.remove("check")
            // }
            
        }
        
        else if(square.classList.contains("black-pawn")){
            removeBlackSelections()
            blackPawn(square)
        }
        else if(square.classList.contains("black-knight")){
            removeBlackSelections()
            blackKnight(square)
            
        }
        else if(square.classList.contains("black-bishop")){
            removeBlackSelections()
            blackBishop(square)
        }
        else if(square.classList.contains("black-rook")){
            removeBlackSelections()
            blackRook(square)
        }
        else if(square.classList.contains("black-king")){
            removeBlackSelections()
            blackKing(square)
        }
        else if(square.classList.contains("black-queen")){
            removeBlackSelections()
            blackQueen(square) 
        }
        else{
            squares.forEach(square =>{
                square.classList.remove("selecting-dark")        
                    square.classList.remove("selecting-light")
                if(square.classList.contains("open-square")){
                    square.classList.remove("open-square")
                    square.classList.remove("capturable-dark")
                    square.classList.remove("capturable-light")
                }
            });

        }

        
        // squares.forEach(square =>{
        //     // //console.log(square.classList.contains("open-square"))
        //     if(square.classList.contains("open-square")&&whitePieces.includes(square.classList[1])){
        //         if(square.classList[0]=="blackSquare"){
        //             // square.classList.remove("open-square")
        //             square.classList.add("capturable-dark")
        //         }
                
        //         else{
        //             // square.classList.remove("open-square")
        //             square.classList.add("capturable-light")
        //         }
        //     }
        // });

        // whitePiecesToCapture()
        blackLastSelectedPiece = square.classList[1]
        blackLastSelectedLocation = 8*(parseInt(square.dataset.idy)-1)+parseInt(square.dataset.idx)-1

        squares.forEach(square =>{
            if(square.classList.contains("open-square")){
                square.addEventListener("mouseover",blackHighlight)
                square.addEventListener("mouseout",blackUnhighlight)
            }
        })


        //limiting moves if black king is in check
        if(selectingPieceBlack){
            if(document.getElementsByClassName("black-king")[0].classList.contains("check")){
                doesMoveHangBlackKing(true)
            }
            else{
                doesMoveHangBlackKing(false)
            }
            whitePiecesToCapture()
            if(blackLastSelectedPiece!="black-king"){
                // console.log("SHOULD BE REMOVING CASTLEABLE")
                squaresMatrix[0][0].classList.remove("castleable-dark")
                squaresMatrix[0][7].classList.remove("castleable-light")
            }
            if(blackPieces.includes(square.classList[1])){
                if(square.classList.contains("blackSquare")){
                    square.classList.add("selecting-dark")
                }
                else{
                    square.classList.add("selecting-light")
                }
            }
            squares.forEach(square =>{
                square.value = 0
            })

            calculateMoveWeightsForBlack()
            
            
           
        }
        
        
        
        whitePiecesToCapture()



        if(!selectingPieceBlack){
            squaresMatrix[0][0].classList.remove("castleable-dark")
            squaresMatrix[0][7].classList.remove("castleable-light")
        }
        squaresMatrix[7][7].classList.remove("castleable-dark")
        squares[56].classList.remove("castleable-light")

        if(blackWon){
            blackWins()
        }


       
    } 


    

    function sleep(duration) {
        console.log("calling sleep")
	return new Promise(resolve => {
		setTimeout(() => {
			resolve()
		}, duration * 1000)
	})
    }

    async function calculateMoveWeightsForBlack(blackAIWasChosen){
        console.log("calling calculateMoveWeightForBlack")
        openSquareValues = document.getElementsByClassName("open-square")
        console.log(openSquareValues.length, " total moves to check")
            if(openSquareValues.length>0){
                for(let square of openSquareValues){
                    square.value=0
                    countPieceValuesAttackingWhite(square)
                    console.log(square, " has value of ",square.value)
                }
                if(blackLastSelectedPiece=="black-pawn"){
                    for(let square of openSquareValues){
                         blackPawnMoveValues(square)
                    }
                }
                else if(blackLastSelectedPiece=="black-knight"){
                    for(let square of openSquareValues){
                         blackKnightMoveValues(square)
                    }
                }
                else if(blackLastSelectedPiece=="black-bishop"){
                    for(let square of openSquareValues){
                         blackBishopMoveValues(square)
                    }
                }



                max=openSquareValues[0].value
                optimalLocationToMoveTo=openSquareValues[0]   //used to be optimalMove=...
                for(let square of openSquareValues){
                    if(square.value>max){
                        max=square.value
                        optimalLocationToMoveTo=square
                        optimalPieceToMove = openSquareValues[0].classList[1]
                        // optimalPieceToMoveLocation = openSquareValues[0]

                    }
                }
                console.log("optimalMove = ",optimalLocationToMoveTo, " with value ",max)
                await sleep(5)
                if(blackAIWasChosen){
                    blackClickBox(optimalLocationToMoveTo)
                }
               
            }
    }
    
    

    function blackAI(){
        console.log("calling blackAI")
        console.log("running function 'blackAI'")
        blackPawns = document.getElementsByClassName("black-pawn")
        for(let pawn of blackPawns){
            blackClickBox(pawn)
        }
    }

    function stateChange(newState) {
        console.log("calling stateChange")
        setTimeout(function(){
            if(newState == -1){alert('VIDEO HAS STOPPED');}
        }, 5000);
        console.log("code that will have to wait")
    }



    function blackPawnMoveValues(square){
        console.log("calling blackPawnMoveValues")
        if(centerSquare.includes(8*(parseInt(square.dataset.idy)-1)+parseInt(square.dataset.idx)-1)){
            square.value+=1
        }
        if((parseInt(square.dataset.idy)-1==4)){
            square.value+=.25
        }
        else if((parseInt(square.dataset.idy)-1==5)){
            square.value+=.5
        }
        else if((parseInt(square.dataset.idy)-1==6)){
            square.value+=2
        }
        else if((parseInt(square.dataset.idy)-1==7)){
            square.value+=8
        }
    }

    function blackKnightMoveValues(square){
        console.log("calling blackKnightMoveValues")
        if(edges.includes(8*(parseInt(square.dataset.idy)-1)+parseInt(square.dataset.idx)-1)){
            square.value-=1
        }
    }

    function blackBishopMoveValues(square){
        console.log("calling blackBishopMoveValues")
        if(fianchettoSquares.includes(8*(parseInt(square.dataset.idy)-1)+parseInt(square.dataset.idx)-1)){
            square.value+=1
        }
    }

    function blackBishopMoveValues(square){
        console.log("calling blackBishopMoveValues")
        if(fianchettoSquares.includes(8*(parseInt(square.dataset.idy)-1)+parseInt(square.dataset.idx)-1)){
            square.value+=1
        }
    }

    



    function doesMoveHangBlackKing(isKinginCheck){
        console.log("calling doesMoveHangBlackKing")
        //console.log("blackLastSelectedPiece = ",blackLastSelectedPiece)
        //console.log("blackLastSelectedLocation = ",blackLastSelectedLocation)
        // //console.log("starting code to limit moves")
        var openSquares = document.getElementsByClassName("open-square")
        const movesToCheck = []
        
        

        for(let square of openSquares){
            // //console.log(8*(parseInt(square.dataset.idy)-1)+parseInt(square.dataset.idx)-1)
            movesToCheck.push(squares[8*(parseInt(square.dataset.idy)-1)+parseInt(square.dataset.idx)-1])
        }
        // for(let square of movesToCheck){
        movesToCheck.forEach(square =>{
            tempPieceHolder = false
            movesToCheck.forEach(square =>{
                square.classList.remove("open-square")
            })
            //if the first move evaluated stops check but the next dont, it doesnt work

            // //console.log("moving to ",8*(parseInt(square.dataset.idy)-1)+parseInt(square.dataset.idx)-1)
            square.classList.add(blackLastSelectedPiece)
            squares[blackLastSelectedLocation].classList.remove(blackLastSelectedPiece)
            if(whitePieces.includes(square.classList[1])){
                tempPiece = square.classList[1]
                tempPieceHolder = true
                square.classList.remove(square.classList[1])
                // if(square.classList.contains(""))
                // square.classList.add("capturable-light")
            }



            // wait(7000);
            // //console.log(square)
            if(blackLastSelectedPiece=="black-king"){
                isBlackKinginCheck(square)
                if(!square.classList.contains("check")){
                    square.classList.add("open-square-that-stops-check") 
                    // //console.log("would bring king out of check")
                }
                // //console.log("dealing with king")
                square.classList.remove("check")
                
            }
            else{
                isBlackKinginCheck(document.getElementsByClassName("black-king")[0])
                

                if(!document.getElementsByClassName("black-king")[0].classList.contains("check")){
                    square.classList.add("open-square-that-stops-check")
                // throw new Error("stop!");
                }
            }
            
            if(tempPieceHolder){
                square.classList.add(tempPiece)
            }
            // square.classList.remove(blackLastSelectedPiece)
            square.classList.remove(blackLastSelectedPiece)
            squares[blackLastSelectedLocation].classList.add(blackLastSelectedPiece)
            if(isKinginCheck){
                document.getElementsByClassName("black-king")[0].classList.add("check")
            }
            else{
                document.getElementsByClassName("black-king")[0].classList.remove("check")
            }

            // if(blackLastSelectedPiece=="black-king"){
            //     //console.log("dealing with king")
            //     square.classList.remove("check")
            // }
            // else{
            //     document.getElementsByClassName("black-king")[0].classList.add("check")
            // }
            // //console.log(square)
            
        })
        // //console.log("done limiting moves")
        for(let square of movesToCheck){
            if(square.classList.contains("open-square-that-stops-check")){
                square.classList.remove("open-square-that-stops-check")
                square.classList.add("open-square")
                //console.log("legal move is ", square)
            }
            else{
                square.removeEventListener("mouseover",blackHighlight)
                square.removeEventListener("mouseout",blackUnhighlight)
            }
        }


        if(whiteLastSelectedPiece=="black-king"){
            //console.log(" king")
        }
        else{
        //console.log("not king")
        squaresMatrix[0][0].classList.remove("castleable-dark")
        squaresMatrix[0][7].classList.remove("castleable-white")
        }
        // whitePiecesToCapture()

    }
        
    

    


    function blackPawn(square){
        console.log("calling blackPawn")
        if(square.classList.contains("blackSquare")){
            square.classList.add("selecting-dark")
        }
        else{
            square.classList.add("selecting-light")
        }
        if(!allPieces.includes(squares[(8*(parseInt(square.dataset.idy)-1)+parseInt(square.dataset.idx)-1)+8].classList[1])){
            // //console.log(squares[(8*(parseInt(square.dataset.idy)-1)+parseInt(square.dataset.idx)-1)+8])
            squares[(8*(parseInt(square.dataset.idy)-1)+parseInt(square.dataset.idx)-1)+8].classList.add("open-square")
            if(parseInt(square.dataset.idy)===2&&!allPieces.includes(squares[(8*(parseInt(square.dataset.idy)-1)+parseInt(square.dataset.idx)-1)+16].classList[1])){
                squares[(8*(parseInt(square.dataset.idy)-1)+parseInt(square.dataset.idx)-1)+16].classList.add("open-square")
            }
        }
        //up to the right
        // //console.log(parseInt(square.dataset.idy)-1)
        if(parseInt(square.dataset.idy)-1+1>-1&&parseInt(square.dataset.idy)-1+1<8
        &&parseInt(square.dataset.idx)-1+1>-1&&parseInt(square.dataset.idx)-1+1<8){
            tempSquare = squares[(8*(parseInt(square.dataset.idy)-1+1)+parseInt(square.dataset.idx)-1+1)]
            if(whitePieces.includes(tempSquare.classList[1])){
                tempSquare.classList.add("open-square")
            }
        }
        
        //up to the left
        if(parseInt(square.dataset.idy)-1+1>-1&&parseInt(square.dataset.idy)-1+1<8
        &&parseInt(square.dataset.idx)-1-1>-1&&parseInt(square.dataset.idx)-1-1<8){
            tempSquare = squares[(8*(parseInt(square.dataset.idy)-1+1)+parseInt(square.dataset.idx)-1-1)]
            if(whitePieces.includes(tempSquare.classList[1])){
                tempSquare.classList.add("open-square")

            }
        }
        //en passant left
        if(parseInt(square.dataset.idy)-1>-1&&parseInt(square.dataset.idy)-1<8
        &&parseInt(square.dataset.idx)-1-1>-1&&parseInt(square.dataset.idx)-1-1<8){
            tempSquare = squares[(8*(parseInt(square.dataset.idy)-1)+parseInt(square.dataset.idx)-1-1)]
            if(tempSquare.classList.contains("white-en-passant-pawn")){
                //console.log("made to here")
                squares[(8*(parseInt(square.dataset.idy)-1+1)+parseInt(square.dataset.idx)-1-1)].classList.add("open-square")
                squares[(8*(parseInt(square.dataset.idy)-1+1)+parseInt(square.dataset.idx)-1-1)].classList.add("black-en-passant-square")
            }
        }
        //en passant right
        if(parseInt(square.dataset.idy)-1>-1&&parseInt(square.dataset.idy)-1<8
        &&parseInt(square.dataset.idx)-1+1>-1&&parseInt(square.dataset.idx)-1+1<8){
            tempSquare = squares[(8*(parseInt(square.dataset.idy)-1)+parseInt(square.dataset.idx)-1+1)]
            if(tempSquare.classList.contains("white-en-passant-pawn")){
                //console.log("made to here")
                squares[(8*(parseInt(square.dataset.idy)-1+1)+parseInt(square.dataset.idx)-1+1)].classList.add("open-square")
                squares[(8*(parseInt(square.dataset.idy)-1+1)+parseInt(square.dataset.idx)-1+1)].classList.add("black-en-passant-square")

            }
        }
    }

    function blackKnight(square){
        console.log("calling blackKnight")
        if(square.classList.contains("blackSquare")){
            square.classList.add("selecting-dark")
        }
        else{
            square.classList.add("selecting-light")
        }
        x=(parseInt(square.dataset.idx)-1+2)
        y=(parseInt(square.dataset.idy)-1-1)
        if(x>-1&&x<8&&y>-1&&y<8&&!blackPieces.includes(squares[(8*(y))+x].classList[1])){
            squares[(8*(y))+x].classList.add("open-square")
        }
        x=(parseInt(square.dataset.idx)-1+2)
        y=(parseInt(square.dataset.idy)-1+1)
        if(x>-1&&x<8&&y>-1&&y<8&&!blackPieces.includes(squares[(8*(y))+x].classList[1])){
            squares[(8*(y))+x].classList.add("open-square")
        }
        x=(parseInt(square.dataset.idx)-1-2)
        y=(parseInt(square.dataset.idy)-1-1)
        if(x>-1&&x<8&&y>-1&&y<8&&!blackPieces.includes(squares[(8*(y))+x].classList[1])){
            squares[(8*(y))+x].classList.add("open-square")
        }
        x=(parseInt(square.dataset.idx)-1-2)
        y=(parseInt(square.dataset.idy)-1+1)
        if(x>-1&&x<8&&y>-1&&y<8&&!blackPieces.includes(squares[(8*(y))+x].classList[1])){
            squares[(8*(y))+x].classList.add("open-square")
        }
        
        x=(parseInt(square.dataset.idx)-1+1)
        y=(parseInt(square.dataset.idy)-1+2)
        if(x>-1&&x<8&&y>-1&&y<8&&!blackPieces.includes(squares[(8*(y))+x].classList[1])){
            squares[(8*(y))+x].classList.add("open-square")
        }
        x=(parseInt(square.dataset.idx)-1+1)
        y=(parseInt(square.dataset.idy)-1-2)
        if(x>-1&&x<8&&y>-1&&y<8&&!blackPieces.includes(squares[(8*(y))+x].classList[1])){
            squares[(8*(y))+x].classList.add("open-square")
        }
        x=(parseInt(square.dataset.idx)-1-1)
        y=(parseInt(square.dataset.idy)-1+2)
        if(x>-1&&x<8&&y>-1&&y<8&&!blackPieces.includes(squares[(8*(y))+x].classList[1])){
            squares[(8*(y))+x].classList.add("open-square")
        }
        x=(parseInt(square.dataset.idx)-1-1)
        y=(parseInt(square.dataset.idy)-1-2)
        if(x>-1&&x<8&&y>-1&&y<8&&!blackPieces.includes(squares[(8*(y))+x].classList[1])){
            squares[(8*(y))+x].classList.add("open-square")
        }
    }

    function blackBishop(square){
        console.log("calling blackBishop")
        if(square.classList.contains("blackSquare")){
            square.classList.add("selecting-dark")
        }
        else{
            square.classList.add("selecting-light")
        }
        var i = 1
        var j = 1
        var flag=true
        while(flag){
            x=(parseInt(square.dataset.idx)-1-i)
            y=(parseInt(square.dataset.idy)-1-j)
            ////console.log(blackPieces.includes(squares[(8*(y))+x]))
            if(x>-1&&x<8&&y>-1&&y<8&&!blackPieces.includes(squares[(8*(y))+x].classList[1])){
                squares[(8*(y))+x].classList.add("open-square")
                if(whitePieces.includes(squares[(8*(y))+x].classList[1])){
                    flag=false
                }
            }
            else{
                flag=false
            }
            i++
            j++
        }
        flag=true
        i=1
        j=1
        while(flag){
            x=(parseInt(square.dataset.idx)-1-i)
            y=(parseInt(square.dataset.idy)-1+j)
            if(x>-1&&x<8&&y>-1&&y<8&&!blackPieces.includes(squares[(8*(y))+x].classList[1])){
                squares[(8*(y))+x].classList.add("open-square")
                if(whitePieces.includes(squares[(8*(y))+x].classList[1])){
                    flag=false
                }
            }
            else{
                flag=false
            }
            i++
            j++
        }
        flag=true
        i=1
        j=1
        while(flag){
            x=(parseInt(square.dataset.idx)-1+i)
            y=(parseInt(square.dataset.idy)-1-j)
            if(x>-1&&x<8&&y>-1&&y<8&&!blackPieces.includes(squares[(8*(y))+x].classList[1])){
                squares[(8*(y))+x].classList.add("open-square")
                if(whitePieces.includes(squares[(8*(y))+x].classList[1])){
                    flag=false
                }
            }
            else{
                flag=false
            }
            i++
            j++
        }
        flag=true
        i=1
        j=1
        while(flag){
            x=(parseInt(square.dataset.idx)-1+i)
            y=(parseInt(square.dataset.idy)-1+j)
            if(x>-1&&x<8&&y>-1&&y<8&&!blackPieces.includes(squares[(8*(y))+x].classList[1])){
                squares[(8*(y))+x].classList.add("open-square")
                if(whitePieces.includes(squares[(8*(y))+x].classList[1])){
                    flag=false
                }
            }
            else{
                flag=false
            }
            i++
            j++
        }
    }

    function blackRook(square){
        console.log("calling blackRook")
        if(square.classList.contains("blackSquare")){
            square.classList.add("selecting-dark")
        }
        else{
            square.classList.add("selecting-light")
        }
        flag=true
        i=1
        while(flag){
            x=(parseInt(square.dataset.idx)-1+i)
            y=(parseInt(square.dataset.idy)-1)
            if(x>-1&&x<8&&y>-1&&y<8&&!blackPieces.includes(squares[(8*(y))+x].classList[1])){
                squares[(8*(y))+x].classList.add("open-square")
                if(whitePieces.includes(squares[(8*(y))+x].classList[1])){
                    flag=false
                }
            }
            else{
                flag=false
            }
            i++
        }
        flag=true
        i=1
        while(flag){
            x=(parseInt(square.dataset.idx)-1-i)
            y=(parseInt(square.dataset.idy)-1)
            if(x>-1&&x<8&&y>-1&&y<8&&!blackPieces.includes(squares[(8*(y))+x].classList[1])){
                squares[(8*(y))+x].classList.add("open-square")
                if(whitePieces.includes(squares[(8*(y))+x].classList[1])){
                    flag=false
                }
            }
            else{
                flag=false
            }
            i++
        }
        flag=true
        i=1
        while(flag){
            x=(parseInt(square.dataset.idx)-1)
            y=(parseInt(square.dataset.idy)-1+i)
            if(x>-1&&x<8&&y>-1&&y<8&&!blackPieces.includes(squares[(8*(y))+x].classList[1])){
                squares[(8*(y))+x].classList.add("open-square")
                if(whitePieces.includes(squares[(8*(y))+x].classList[1])){
                    flag=false
                }
            }
            else{
                flag=false
            }
            i++
        }
        flag=true
        i=1
        while(flag){
            x=(parseInt(square.dataset.idx)-1)
            y=(parseInt(square.dataset.idy)-1-i)
            if(x>-1&&x<8&&y>-1&&y<8&&!blackPieces.includes(squares[(8*(y))+x].classList[1])){
                squares[(8*(y))+x].classList.add("open-square")
                if(whitePieces.includes(squares[(8*(y))+x].classList[1])){
                    flag=false
                }
            }
            else{
                flag=false
            }
            i++
        }
    }

    function blackKing(square){
        console.log("calling blackKing")
        if(square.classList.contains("blackSquare")){
            square.classList.add("selecting-dark")
        }
        else{
            square.classList.add("selecting-light")
        }
        x=(parseInt(square.dataset.idx)-1)
        y=(parseInt(square.dataset.idy)-1+1)
        if(x>-1&&x<8&&y>-1&&y<8&&!blackPieces.includes(squares[(8*(y))+x].classList[1])){
            squares[(8*(y))+x].classList.add("open-square")
        }
        x=(parseInt(square.dataset.idx)-1)
        y=(parseInt(square.dataset.idy)-1-1)
        if(x>-1&&x<8&&y>-1&&y<8&&!blackPieces.includes(squares[(8*(y))+x].classList[1])){
            squares[(8*(y))+x].classList.add("open-square")
        }
        x=(parseInt(square.dataset.idx)-1+1)
        y=(parseInt(square.dataset.idy)-1-1)
        if(x>-1&&x<8&&y>-1&&y<8&&!blackPieces.includes(squares[(8*(y))+x].classList[1])){
            squares[(8*(y))+x].classList.add("open-square")
        }
        x=(parseInt(square.dataset.idx)-1+1)
        y=(parseInt(square.dataset.idy)-1)
        if(x>-1&&x<8&&y>-1&&y<8&&!blackPieces.includes(squares[(8*(y))+x].classList[1])){
            squares[(8*(y))+x].classList.add("open-square")
        }
        x=(parseInt(square.dataset.idx)-1+1)
        y=(parseInt(square.dataset.idy)-1+1)
        if(x>-1&&x<8&&y>-1&&y<8&&!blackPieces.includes(squares[(8*(y))+x].classList[1])){
            squares[(8*(y))+x].classList.add("open-square")
        }
        x=(parseInt(square.dataset.idx)-1-1)
        y=(parseInt(square.dataset.idy)-1-1)
        if(x>-1&&x<8&&y>-1&&y<8&&!blackPieces.includes(squares[(8*(y))+x].classList[1])){
            squares[(8*(y))+x].classList.add("open-square")
        }
        x=(parseInt(square.dataset.idx)-1-1)
        y=(parseInt(square.dataset.idy)-1)
        if(x>-1&&x<8&&y>-1&&y<8&&!blackPieces.includes(squares[(8*(y))+x].classList[1])){
            squares[(8*(y))+x].classList.add("open-square")
        }
        x=(parseInt(square.dataset.idx)-1-1)
        y=(parseInt(square.dataset.idy)-1+1)
        if(x>-1&&x<8&&y>-1&&y<8&&!blackPieces.includes(squares[(8*(y))+x].classList[1])){
            squares[(8*(y))+x].classList.add("open-square")
        }
        if(!blackKingOrRookMoved&&!allPieces.includes(squaresMatrix[0][5].classList[1])&&!allPieces.includes(squaresMatrix[0][6].classList[1])){
            squaresMatrix[0][6].classList.add("open-square")
            squaresMatrix[0][7].classList.add("open-square")
            squaresMatrix[0][7].classList.add("castleable-light")
        }
        if(!blackKingOrRookMoved&&!allPieces.includes(squaresMatrix[0][3].classList[1])&&!allPieces.includes(squaresMatrix[0][2].classList[1])&&!allPieces.includes(squaresMatrix[0][1].classList[1])){
            squaresMatrix[0][2].classList.add("open-square")
            squaresMatrix[0][0].classList.add("open-square")
            squaresMatrix[0][0].classList.add("castleable-dark")
        }
    }


    function blackQueen(square){
        console.log("calling blackQueen")
        if(square.classList.contains("blackSquare")){
                square.classList.add("selecting-dark")
            }
            else{
                square.classList.add("selecting-light")
            }
            var i = 1
            var j = 1
            var flag=true
            while(flag){
                x=(parseInt(square.dataset.idx)-1-i)
                y=(parseInt(square.dataset.idy)-1-j)
                if(x>-1&&x<8&&y>-1&&y<8&&!blackPieces.includes(squares[(8*(y))+x].classList[1])){
                    squares[(8*(y))+x].classList.add("open-square")
                    if(whitePieces.includes(squares[(8*(y))+x].classList[1])){
                        flag=false
                    }
                }
                else{
                    flag=false
                }
                i++
                j++
            }
            flag=true
            i=1
            j=1
            while(flag){
                x=(parseInt(square.dataset.idx)-1-i)
                y=(parseInt(square.dataset.idy)-1+j)
                if(x>-1&&x<8&&y>-1&&y<8&&!blackPieces.includes(squares[(8*(y))+x].classList[1])){
                    squares[(8*(y))+x].classList.add("open-square")
                    if(whitePieces.includes(squares[(8*(y))+x].classList[1])){
                        flag=false
                    }
                }
                else{
                    flag=false
                }
                i++
                j++
            }
            flag=true
            i=1
            j=1
            while(flag){
                x=(parseInt(square.dataset.idx)-1+i)
                y=(parseInt(square.dataset.idy)-1-j)
                if(x>-1&&x<8&&y>-1&&y<8&&!blackPieces.includes(squares[(8*(y))+x].classList[1])){
                    squares[(8*(y))+x].classList.add("open-square")
                    if(whitePieces.includes(squares[(8*(y))+x].classList[1])){
                        flag=false
                    }
                }
                else{
                    flag=false
                }
                i++
                j++
            }
            flag=true
            i=1
            j=1
            while(flag){
                x=(parseInt(square.dataset.idx)-1+i)
                y=(parseInt(square.dataset.idy)-1+j)
                if(x>-1&&x<8&&y>-1&&y<8&&!blackPieces.includes(squares[(8*(y))+x].classList[1])){
                    squares[(8*(y))+x].classList.add("open-square")
                    if(whitePieces.includes(squares[(8*(y))+x].classList[1])){
                        flag=false
                    }
                }
                else{
                    flag=false
                }
                i++
                j++
            }
            flag=true
            i=1
            while(flag){
                x=(parseInt(square.dataset.idx)-1+i)
                y=(parseInt(square.dataset.idy)-1)
                if(x>-1&&x<8&&y>-1&&y<8&&!blackPieces.includes(squares[(8*(y))+x].classList[1])){
                    squares[(8*(y))+x].classList.add("open-square")
                    if(whitePieces.includes(squares[(8*(y))+x].classList[1])){
                        flag=false
                    }
                }
                else{
                    flag=false
                }
                i++
            }
            flag=true
            i=1
            while(flag){
                x=(parseInt(square.dataset.idx)-1-i)
                y=(parseInt(square.dataset.idy)-1)
                if(x>-1&&x<8&&y>-1&&y<8&&!blackPieces.includes(squares[(8*(y))+x].classList[1])){
                    squares[(8*(y))+x].classList.add("open-square")
                    if(whitePieces.includes(squares[(8*(y))+x].classList[1])){
                        flag=false
                    }
                }
                else{
                    flag=false
                }
                i++
            }
            flag=true
            i=1
            while(flag){
                x=(parseInt(square.dataset.idx)-1)
                y=(parseInt(square.dataset.idy)-1+i)
                if(x>-1&&x<8&&y>-1&&y<8&&!blackPieces.includes(squares[(8*(y))+x].classList[1])){
                    squares[(8*(y))+x].classList.add("open-square")
                    if(whitePieces.includes(squares[(8*(y))+x].classList[1])){
                        flag=false
                    }
                }
                else{
                    flag=false
                }
                i++
            }
            flag=true
            i=1
            while(flag){
                x=(parseInt(square.dataset.idx)-1)
                y=(parseInt(square.dataset.idy)-1-i)
                if(x>-1&&x<8&&y>-1&&y<8&&!blackPieces.includes(squares[(8*(y))+x].classList[1])){
                    squares[(8*(y))+x].classList.add("open-square")
                    if(whitePieces.includes(squares[(8*(y))+x].classList[1])){
                        flag=false
                    }
                }
                else{
                    flag=false
                }
                i++
            }
    }

    function whiteWins(){
        console.log("calling whiteWins")
        let winner=document.querySelector(".winner")
        winner.innerHTML="White Won!"
        // currentPlayer.innerHTML=""
        // var x = document.querySelector('.player')
        // x.innerHTML=''
        var span = document.querySelector(".currentPlayer");
        //console.log(span.childNodes[1])
        span.removeChild(span.childNodes[1]);  
    }

    function blackWins(){
        console.log("calling blackWins")
        //console.log("blackWins")
        let winner=document.querySelector(".winner")
        winner.innerHTML="Black Won!"
        // currentPlayer.innerHTML=""
        // var x = document.querySelector('.player')
        // x.innerHTML=''
        var span = document.querySelector(".currentPlayer");
        //console.log(span.childNodes[1])
        span.removeChild(span.childNodes[1]);  
    }

//     function selecting(){

//         let square = squares[8*(parseInt(this.dataset.idy)-1)+parseInt(this.dataset.idx)-1]
//         if(square.classList.contains("open-square")){
//             square.classList.remove("open-square")
//             square.classList.add(whiteLastSelectedPiece)
//             squares[whiteLastSelectedLocation].classList.remove(whiteLastSelectedPiece)
//             squares.forEach(square =>{
//                 if(square.classList.contains("open-square")){
//                     square.classList.remove("open-square")
//                 }
//             });
//         }
//         else{
            
//         }
//         Array.from(squares).forEach(square=>{ 
//             square.addEventListener("click",whiteClickBox)
//             square.removeEventListener("click",selecting)
//         })
//         // let open_squares = document.querySelectorAll("open-square")
//         // //console.log(open_squares)
// //         [].forEach.call(document.querySelectorAll("open-square"),function(e){
// //   e.parentNode.removeChild(e);
// // });
//         // var open_squares = document.getElementsByClassName("open-square")
        
//         }





       ////console.log(squares)
        // //console.log(parseInt(this.dataset.idx),parseInt(this.dataset.idy))
        // //console.log(square)
        // if(!square)){ 
        //     if(currentPlayer==='white'){ 
        //         currentPlayer='black' 
        //         player.innerHTML=currentPlayer
        //         this.className="player-one taken" 
        //        // checkWon() 
        //      }else if(currentPlayer==='black'){ 
        //         currentPlayer='white'
        //         player.innerHTML=currentPlayer 
        //         this.className="player-two taken" 
        //         //checkWon() 
        //     } 
        // }else{
        //     // alert("You cannot build on an empty space or on a space that has been built on")
        // } 
    
        //the checkWon function
    function checkWon(){
        console.log("calling checkWon")
        let squares =document.querySelectorAll(".board div")
        for (let y=0;y<winningArray.length;y++){
            let square =winningArray[y]
            if(square.every(q=>squares[q].classList.contains("player-one"))){
                setTimeout(() =>alert("player one(red) wins "), 200)
                setTimeout(() =>restart.style.display="flex", 500)
            }else if(square.every(q=>squares[q].classList.contains("player-two"))){
                setTimeout(() =>alert("player two(yellow) wins"), 200)
                setTimeout(() =>restart.style.display="flex", 500)
            }
        }
    }

    function reset(){
        console.log("calling reset")
        board.innerHTML="" 
        loadDOM() 
        restart.style.display="none" 
    }

   

</script>

